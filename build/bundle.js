var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let s,l;function a(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function h(e){return document.createElement(e)}function f(e){return document.createTextNode(e)}function d(){return f(" ")}function p(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function m(e){return function(t){return t.preventDefault(),e.call(this,t)}}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function $(e){return""===e?null:+e}function b(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function x(e,t){e.value=null==t?"":t}function v(e){l=e}function k(){if(!l)throw new Error("Function called outside component initialization");return l}function w(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const y=[],S=[],C=[],M=[],j=Promise.resolve();let P=!1;function D(e){C.push(e)}const L=new Set;let E=0;function H(){const e=l;do{for(;E<y.length;){const e=y[E];E++,v(e),A(e.$$)}for(v(null),y.length=0,E=0;S.length;)S.pop()();for(let e=0;e<C.length;e+=1){const t=C[e];L.has(t)||(L.add(t),t())}C.length=0}while(y.length);for(;M.length;)M.pop()();P=!1,L.clear(),v(e)}function A(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(D)}}const _=new Set;let T;function z(){T={r:0,c:[],p:T}}function F(){T.r||r(T.c),T=T.p}function W(e,t){e&&e.i&&(_.delete(e),e.i(t))}function G(e,t,n,r){if(e&&e.o){if(_.has(e))return;_.add(e),T.c.push((()=>{_.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}function R(e,t){const n=t.token={};function r(e,r,o,i){if(t.token!==n)return;t.resolved=i;let s=t.ctx;void 0!==o&&(s=s.slice(),s[o]=i);const l=e&&(t.current=e)(s);let a=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(z(),G(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),F())})):t.block.d(1),l.c(),W(l,1),l.m(t.mount(),t.anchor),a=!0),t.block=l,t.blocks&&(t.blocks[r]=l),a&&H()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const n=k();if(e.then((e=>{v(n),r(t.then,1,t.value,e),v(null)}),(e=>{if(v(n),r(t.catch,2,t.error,e),v(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}var o}function N(e){e&&e.c()}function q(e,n,i,s){const{fragment:l,on_mount:a,on_destroy:c,after_update:u}=e.$$;l&&l.m(n,i),s||D((()=>{const n=a.map(t).filter(o);c?c.push(...n):r(n),e.$$.on_mount=[]})),u.forEach(D)}function O(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function U(e,t){-1===e.$$.dirty[0]&&(y.push(e),P||(P=!0,j.then(H)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function B(t,o,i,s,a,c,h,f=[-1]){const d=l;v(t);const p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||d.$$.root};h&&h(p.root);let m=!1;if(p.ctx=i?i(t,o.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&a(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),m&&U(t,e)),n})):[],p.update(),m=!0,r(p.before_update),p.fragment=!!s&&s(p.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);p.fragment&&p.fragment.l(e),e.forEach(u)}else p.fragment&&p.fragment.c();o.intro&&W(t.$$.fragment),q(t,o.target,o.anchor,o.customElement),H()}v(d)}class X{$destroy(){O(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function I(t){let n,r;return{c(){n=h("span"),r=f(t[0]),g(n,"class","material-icons svelte-1ak8vae")},m(e,t){c(e,n,t),a(n,r)},p(e,[t]){1&t&&b(r,e[0])},i:e,o:e,d(e){e&&u(n)}}}function J(e,t,n){let{name:r}=t;return e.$$set=e=>{"name"in e&&n(0,r=e.name)},[r]}class V extends X{constructor(e){super(),B(this,e,J,I,i,{name:0})}}function K(t){let n,r,o;return{c(){n=h("a"),r=f(t[1]),g(n,"href",o=null==t[0]?"help":`help#${t[0]}`),g(n,"target","_blank"),g(n,"class","noprint svelte-o7pe1m")},m(e,t){c(e,n,t),a(n,r)},p(e,[t]){2&t&&b(r,e[1]),1&t&&o!==(o=null==e[0]?"help":`help#${e[0]}`)&&g(n,"href",o)},i:e,o:e,d(e){e&&u(n)}}}function Z(e,t,n){let{topic:r=null}=t,{label:o="?"}=t;return e.$$set=e=>{"topic"in e&&n(0,r=e.topic),"label"in e&&n(1,o=e.label)},[r,o]}class Q extends X{constructor(e){super(),B(this,e,Z,K,i,{topic:0,label:1})}}function Y(e){const{h:t,m:n}=te(e);return`${t}:${ne(n)}`}function ee(e){const{h:t,m:n}=te(e);return`${ne(t%24)}:${ne(n)}`}function te(e){const t=Math.floor(e);return{h:t,m:Math.round(60*(e-t))}}function ne(e){return e<10?`0${e}`:e.toString()}function re(e){let t,n,r,o,i,s,l,p,m,g,$,x,v,k,w,y,S,C,M,j,P,D,L,E,H,A,_,T,z,F,R,U,B,X,I,J,V,K,Z,ee,te=e[0].markers[0].name+"",ne=e[0].markers[e[0].markers.length-1].name+"",re=Math.round(e[3])+"",oe=Math.round(e[2])+"",ie=(e[0].distanceSum[e[0].line.length-1]/1e3).toFixed(1)+"",se=e[0].effortSum[e[0].markers.length-1].toFixed(1)+"",le=Y(e[0].effortSum[e[0].markers.length-1]/e[1])+"";return T=new Q({props:{topic:"calculation"}}),{c(){t=f("Start: "),n=h("b"),r=f(te),o=h("br"),i=f("\r\nEnde: "),s=h("b"),l=f(ne),p=h("br"),m=f("\r\nAuf-/Abstieg: ↑ "),g=h("b"),$=f(re),x=f(" m"),v=f(" ↓ "),k=h("b"),w=f(oe),y=f(" m"),S=h("br"),C=f("\r\nDistanz: "),M=h("b"),j=f(ie),P=f(" km"),D=h("br"),L=f("\r\nAufwand: "),E=h("b"),H=f(se),A=f(" Lkm"),_=d(),N(T.$$.fragment),z=h("br"),F=f("\r\nGeschwindigkeit: "),R=h("b"),U=f(e[1]),B=f(" Lkm/h"),X=h("br"),I=f("\r\nDauer: "),J=h("b"),V=f(le),K=f(" h"),Z=h("br")},m(e,u){c(e,t,u),c(e,n,u),a(n,r),c(e,o,u),c(e,i,u),c(e,s,u),a(s,l),c(e,p,u),c(e,m,u),c(e,g,u),a(g,$),a(g,x),c(e,v,u),c(e,k,u),a(k,w),a(k,y),c(e,S,u),c(e,C,u),c(e,M,u),a(M,j),a(M,P),c(e,D,u),c(e,L,u),c(e,E,u),a(E,H),a(E,A),c(e,_,u),q(T,e,u),c(e,z,u),c(e,F,u),c(e,R,u),a(R,U),a(R,B),c(e,X,u),c(e,I,u),c(e,J,u),a(J,V),a(J,K),c(e,Z,u),ee=!0},p(e,[t]){(!ee||1&t)&&te!==(te=e[0].markers[0].name+"")&&b(r,te),(!ee||1&t)&&ne!==(ne=e[0].markers[e[0].markers.length-1].name+"")&&b(l,ne),(!ee||8&t)&&re!==(re=Math.round(e[3])+"")&&b($,re),(!ee||4&t)&&oe!==(oe=Math.round(e[2])+"")&&b(w,oe),(!ee||1&t)&&ie!==(ie=(e[0].distanceSum[e[0].line.length-1]/1e3).toFixed(1)+"")&&b(j,ie),(!ee||1&t)&&se!==(se=e[0].effortSum[e[0].markers.length-1].toFixed(1)+"")&&b(H,se),(!ee||2&t)&&b(U,e[1]),(!ee||3&t)&&le!==(le=Y(e[0].effortSum[e[0].markers.length-1]/e[1])+"")&&b(V,le)},i(e){ee||(W(T.$$.fragment,e),ee=!0)},o(e){G(T.$$.fragment,e),ee=!1},d(e){e&&u(t),e&&u(n),e&&u(o),e&&u(i),e&&u(s),e&&u(p),e&&u(m),e&&u(g),e&&u(v),e&&u(k),e&&u(S),e&&u(C),e&&u(M),e&&u(D),e&&u(L),e&&u(E),e&&u(_),O(T,e),e&&u(z),e&&u(F),e&&u(R),e&&u(X),e&&u(I),e&&u(J),e&&u(Z)}}}function oe(e,t,n){let r,o,{route:i}=t,{speed:s}=t;return e.$$set=e=>{"route"in e&&n(0,i=e.route),"speed"in e&&n(1,s=e.speed)},e.$$.update=()=>{1&e.$$.dirty&&n(3,({ascent:r,descent:o}=function(e){let t=0,n=0;for(let r=1;r<e.markers.length;r++){const o=e.markerProfile[r].height-e.markerProfile[r-1].height;o>0?t+=o:n-=o}return{ascent:t,descent:n}}(i)),r,(n(2,o),n(0,i)))},[i,s,o,r]}class ie extends X{constructor(e){super(),B(this,e,oe,re,i,{route:0,speed:1})}}class se{static add(e,t){return{x:e.x+t.x,y:e.y+t.y}}static subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}}static scale(e,t){return{x:e.x*t,y:e.y*t}}static length(e){return Math.hypot(e.x,e.y)}static distance(e,t){return se.length(se.subtract(t,e))}}const le={backgroundColor:null,textColor:null,darkerAccentColor:null,accentColor:null,lighterAccentColor:null};function ae(t){let n;return{c(){n=h("canvas"),g(n,"class","svelte-xd84ci")},m(e,r){c(e,n,r),t[2](n)},p:e,i:e,o:e,d(e){e&&u(n),t[2](null)}}}function ce(e,t,n){let r,{route:o}=t;return e.$$set=e=>{"route"in e&&n(1,o=e.route)},e.$$.update=()=>{3&e.$$.dirty&&r&&(n(0,r.width=800,r),n(0,r.height=150,r),function(e,t){const n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);const r=12;let o=1/0,i=-1/0;for(let t of e.lineProfile)o=Math.min(o,t.height),i=Math.max(i,t.height);const s={x:e.distanceSum[e.distanceSum.length-1],y:i-o},l=Math.min((t.width-24)/s.x,(t.height-24-40)/s.y);t.width=Math.floor(s.x*l+24),t.height=Math.floor(s.y*l+24+40);const a=(e,n)=>se.add(se.scale({x:e,y:o-n},l),{x:r,y:t.height-r-40}),c=()=>{for(let t=0;t<e.lineProfile.length;t++){const r=a(e.lineProfileDistanceSum[t],e.lineProfile[t].height);0===t?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y)}};n.beginPath(),c();const u=a(0,i),h=a(0,o),f=a(s.x,o);n.lineTo(f.x,t.height),n.lineTo(h.x,t.height);const d=n.createLinearGradient(0,u.y,0,t.height);d.addColorStop(0,le.lighterAccentColor),d.addColorStop(1,le.backgroundColor),n.fillStyle=d,n.fill(),n.beginPath(),c(),n.lineWidth=4,n.lineCap=n.lineJoin="round",n.strokeStyle=le.accentColor,n.stroke(),n.font="bold 14px sans-serif",n.textAlign="center",n.textBaseline="middle";for(let t=0;t<e.markerProfile.length;t++){const r=a(e.distanceSum[e.markers[t].index],e.markerProfile[t].height);n.beginPath(),n.arc(r.x,r.y,10,0,2*Math.PI),n.fillStyle=le.darkerAccentColor,n.fill(),n.fillStyle=le.backgroundColor,n.fillText(t+1,r.x,r.y+.5)}const p=25*2**Math.floor(Math.log2(100/(25*l))),m=p*l;n.fillStyle=le.textColor,n.fillRect(t.width-r-m,t.height-4,m,2),n.fillRect(t.width-r-m,t.height-6,2,6),n.fillRect(t.width-r-2,t.height-6,2,6),n.textAlign="right",n.textBaseline="bottom",n.fillText(`${p} m`,t.width-r,t.height-6)}(o,r))},[r,o,function(e){S[e?"unshift":"push"]((()=>{r=e,n(0,r),n(1,o)}))}]}class ue extends X{constructor(e){super(),B(this,e,ce,ae,i,{route:1})}}function he(e,t,n){const r=e.slice();return r[4]=t[n],r}function fe(e){let t,n,r,o,i,s,l,p,m,$,x,v,k,w,y,S,C,M,j,P,D=Math.round(e[4].diff.height)+"",L=e[4].diff.distance.toFixed(1)+"",E=e[4].diff.effort.toFixed(1)+"",H=Y(e[4].diff.duration)+"";return{c(){t=h("tr"),n=h("td"),r=d(),o=h("td"),i=f(D),s=f(" m"),l=d(),p=h("td"),m=f(L),$=f(" km"),x=d(),v=h("td"),k=f(E),w=f(" Lkm"),y=d(),S=h("td"),C=f(H),M=f(" h"),j=d(),P=h("td"),g(n,"class","svelte-xjpfse"),g(o,"class","number svelte-xjpfse"),g(p,"class","number svelte-xjpfse"),g(v,"class","number svelte-xjpfse"),g(S,"class","number svelte-xjpfse"),g(P,"class","svelte-xjpfse"),g(t,"class","alt svelte-xjpfse")},m(e,u){c(e,t,u),a(t,n),a(t,r),a(t,o),a(o,i),a(o,s),a(t,l),a(t,p),a(p,m),a(p,$),a(t,x),a(t,v),a(v,k),a(v,w),a(t,y),a(t,S),a(S,C),a(S,M),a(t,j),a(t,P)},p(e,t){1&t&&D!==(D=Math.round(e[4].diff.height)+"")&&b(i,D),1&t&&L!==(L=e[4].diff.distance.toFixed(1)+"")&&b(m,L),1&t&&E!==(E=e[4].diff.effort.toFixed(1)+"")&&b(k,E),1&t&&H!==(H=Y(e[4].diff.duration)+"")&&b(C,H)},d(e){e&&u(t)}}}function de(e){let t,n,r,o,i,s,l,p,m,$,x,v,k,w,y,S,C,M,j,P,D,L,E,H,A,_,T,z=e[4].index+"",F=e[4].name+"",W=Math.round(e[4].height)+"",G=e[4].distance.toFixed(1)+"",R=e[4].effort.toFixed(1)+"",N=Y(e[4].duration)+"",q=ee(e[4].duration)+"",O=e[4].diff&&fe(e);return{c(){O&&O.c(),t=d(),n=h("tr"),r=h("td"),o=h("span"),i=f(z),s=d(),l=f(F),p=d(),m=h("td"),$=f(W),x=f(" m"),v=d(),k=h("td"),w=f(G),y=f(" km"),S=d(),C=h("td"),M=f(R),j=f(" Lkm"),P=d(),D=h("td"),L=f(N),E=f(" h"),H=d(),A=h("td"),_=f(q),T=d(),g(o,"class","svelte-xjpfse"),g(r,"class","name svelte-xjpfse"),g(m,"class","number svelte-xjpfse"),g(k,"class","number svelte-xjpfse"),g(C,"class","number svelte-xjpfse"),g(D,"class","number svelte-xjpfse"),g(A,"class","number svelte-xjpfse")},m(e,u){O&&O.m(e,u),c(e,t,u),c(e,n,u),a(n,r),a(r,o),a(o,i),a(r,s),a(r,l),a(n,p),a(n,m),a(m,$),a(m,x),a(n,v),a(n,k),a(k,w),a(k,y),a(n,S),a(n,C),a(C,M),a(C,j),a(n,P),a(n,D),a(D,L),a(D,E),a(n,H),a(n,A),a(A,_),a(n,T)},p(e,n){e[4].diff?O?O.p(e,n):(O=fe(e),O.c(),O.m(t.parentNode,t)):O&&(O.d(1),O=null),1&n&&z!==(z=e[4].index+"")&&b(i,z),1&n&&F!==(F=e[4].name+"")&&b(l,F),1&n&&W!==(W=Math.round(e[4].height)+"")&&b($,W),1&n&&G!==(G=e[4].distance.toFixed(1)+"")&&b(w,G),1&n&&R!==(R=e[4].effort.toFixed(1)+"")&&b(M,R),1&n&&N!==(N=Y(e[4].duration)+"")&&b(L,N),1&n&&q!==(q=ee(e[4].duration)+"")&&b(_,q)},d(e){O&&O.d(e),e&&u(t),e&&u(n)}}}function pe(e){let t,n,r,o,i,s,l,m,$,b,x,v,k=e[0],w=[];for(let t=0;t<k.length;t+=1)w[t]=de(he(e,k,t));return m=new V({props:{name:"output"}}),{c(){t=h("table"),n=h("tr"),n.innerHTML='<th class="svelte-xjpfse">Wegpunkt</th> \n        <th class="svelte-xjpfse">Höhe</th> \n        <th class="svelte-xjpfse">Distanz</th> \n        <th class="svelte-xjpfse">Aufwand</th> \n        <th class="svelte-xjpfse">Dauer</th> \n        <th class="svelte-xjpfse">Uhrzeit</th>',r=d();for(let e=0;e<w.length;e+=1)w[e].c();o=d(),i=h("br"),s=d(),l=h("button"),N(m.$$.fragment),$=f(" CSV exportieren"),g(t,"class","svelte-xjpfse"),g(l,"class","noprint")},m(u,h){c(u,t,h),a(t,n),a(t,r);for(let e=0;e<w.length;e+=1)w[e].m(t,null);c(u,o,h),c(u,i,h),c(u,s,h),c(u,l,h),q(m,l,null),a(l,$),b=!0,x||(v=p(l,"click",e[1]),x=!0)},p(e,[n]){if(1&n){let r;for(k=e[0],r=0;r<k.length;r+=1){const o=he(e,k,r);w[r]?w[r].p(o,n):(w[r]=de(o),w[r].c(),w[r].m(t,null))}for(;r<w.length;r+=1)w[r].d(1);w.length=k.length}},i(e){b||(W(m.$$.fragment,e),b=!0)},o(e){G(m.$$.fragment,e),b=!1},d(e){e&&u(t),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(w,e),e&&u(o),e&&u(i),e&&u(s),e&&u(l),O(m),x=!1,v()}}}function me(e,t,n){let{route:r}=t,{speed:o}=t,i=[];return e.$$set=e=>{"route"in e&&n(2,r=e.route),"speed"in e&&n(3,o=e.speed)},e.$$.update=()=>{12&e.$$.dirty&&!window.isNaN(o)&&o>0&&n(0,i=function(e,t){const n=[];for(let r=0;r<e.markers.length;r++)n[r]={index:r+1,name:e.markers[r].name,height:e.markerProfile[r].height,distance:e.distanceSum[e.markers[r].index]/1e3,effort:e.effortSum[r],duration:e.effortSum[r]/t},r>0&&(n[r].diff={height:n[r].height-n[r-1].height,distance:n[r].distance-n[r-1].distance,effort:e.effort[r],duration:n[r].duration-n[r-1].duration});return n}(r,o))},[i,function(){const e=[["Nr.","Name","Höhe / m","Unterschied Höhe / m","Total Distanz / km","Unterschied Distanz / km","Total Aufwand / Lkm","Unterschied Aufwand / Lkm","Total Dauer / h","Unterschied Dauer / h","Uhrzeit / h"],...i.map((e=>[e.index,e.name,e.height,e.diff?.height??0,e.distance,e.diff?.distance??0,e.effort,e.diff?.effort??0,e.duration,e.diff?.duration??0,e.duration]))].map((e=>e.map((e=>`"${e}"`)).join(","))).join("\n"),t=document.createElement("a");t.href=URL.createObjectURL(new Blob([e],{type:"text/csv"})),t.download="marschzeittabelle.csv",t.click()},r,o]}class ge extends X{constructor(e){super(),B(this,e,me,pe,i,{route:2,speed:3})}}function $e(t){let n,r,o,i,l,p,m,$,b,x,v,k,w,y,S,C,M,j,P,D,L;return w=new Q({props:{topic:"export",label:"Wie geht das?"}}),{c(){var e,t;n=h("div"),n.innerHTML='<h1 class="svelte-1578vb4">Marschzeit­tabelle<br/>leicht gemacht.</h1> \n<p class="subtitle svelte-1578vb4">Wir übertragen deine Route automatisch in eine Marschzeittabelle, damit du dich auf die Wanderplanung konzentrieren kannst.</p>',r=d(),o=h("div"),i=h("div"),l=h("h2"),l.textContent="1. Planen",p=d(),m=h("p"),m.textContent="Route einzeichnen und Wegpunkte benennen - das kennst du bereits.",$=d(),b=h("h2"),b.textContent="2. Exportieren",x=d(),v=h("p"),k=f("In wenigen Klicks erledigt. "),N(w.$$.fragment),y=d(),S=h("h2"),S.textContent="3. Hochladen",C=d(),M=h("p"),M.textContent="Jetzt noch Geschwindigkeit, Startzeit, Bemerkungen und Pausen hinzufügen.",j=d(),P=h("img"),g(n,"class","title svelte-1578vb4"),g(l,"class","svelte-1578vb4"),g(m,"class","svelte-1578vb4"),g(b,"class","svelte-1578vb4"),g(v,"class","svelte-1578vb4"),g(S,"class","svelte-1578vb4"),g(M,"class","svelte-1578vb4"),g(i,"class","svelte-1578vb4"),e=P.src,t=D="example.png",s||(s=document.createElement("a")),s.href=t,e!==s.href&&g(P,"src","example.png"),g(P,"alt","Beispiel"),g(P,"class","svelte-1578vb4"),g(o,"class","tutorial svelte-1578vb4")},m(e,t){c(e,n,t),c(e,r,t),c(e,o,t),a(o,i),a(i,l),a(i,p),a(i,m),a(i,$),a(i,b),a(i,x),a(i,v),a(v,k),q(w,v,null),a(i,y),a(i,S),a(i,C),a(i,M),a(o,j),a(o,P),L=!0},p:e,i(e){L||(W(w.$$.fragment,e),L=!0)},o(e){G(w.$$.fragment,e),L=!1},d(e){e&&u(n),e&&u(r),e&&u(o),O(w)}}}class be extends X{constructor(e){super(),B(this,e,null,$e,i,{})}}function xe(e,t,n){const r={type:"LineString",coordinates:e.map((e=>[Math.round(e.x),Math.round(e.y)]))};return fetch("https://api3.geo.admin.ch/rest/services/profile.json",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`sr=21781&distinct_points=${t}&nb_points=${n}&geom=${JSON.stringify(r)}`}).then((e=>{if(e.ok)return e.json();throw"Das Höhenprofil konnte nicht geladen werden."})).then((n=>new Promise((r=>{let o=n.map((e=>({point:{x:e.easting,y:e.northing},height:e.alts.COMB})));t&&(o=o.filter((t=>e.some((e=>se.distance(t.point,e)<2))))),r(o)})))).catch((()=>{throw"Die Verbindung zu den swisstopo-Servern ist fehlgeschlagen."}))}class ve{constructor(e,t){this.line=e,this.markers=t}async loadProfiles(){return this.lineProfile=await xe(this.line,!1,100),this.markerProfile=await xe(this.markers.map((e=>this.line[e.index])),!0,this.markers.length),this.calculateDistances(),this}reverse(){this.line.reverse(),this.markers.reverse(),this.markers.forEach((e=>e.index=this.line.length-e.index-1)),this.lineProfile?.reverse(),this.markerProfile?.reverse(),this.calculateDistances()}calculateDistances(){this.distanceSum=ke(this.line),this.lineProfileDistanceSum=ke(this.lineProfile.map((e=>e.point))),this.effort=[],this.effort[0]=0;for(let e=1;e<this.markers.length;e++){const t=this.distanceSum[this.markers[e].index]-this.distanceSum[this.markers[e-1].index],n=this.markerProfile[e].height-this.markerProfile[e-1].height,r=n/t;this.effort[e]=t/1e3,r>0?this.effort[e]+=n/100:r<-.2&&(this.effort[e]+=Math.abs(r)/150)}this.effortSum=we(this.effort)}}function ke(e){return we(e.map(((t,n)=>se.distance(e[Math.max(0,n-1)],e[n]))))}function we(e){const t=[];let n=0;for(let r=0;r<e.length;r++)n+=e[r],t[r]=n;return t}function ye(e){return function(e){return new Promise(((t,n)=>{const r=new FileReader;r.addEventListener("load",(()=>t(r.result))),r.addEventListener("error",(()=>n("Die Datei konnte nicht gelesen werden."))),r.readAsText(e)}))}(e).then((e=>async function(e){const t=(new DOMParser).parseFromString(e,"application/xml");if(t.querySelector("parsererror"))throw"Die Datei ist nicht in gültigem XML-Format.";return t}(e))).then((t=>e.name.endsWith(".kml")?async function(e){const t=[],n=[],r=e=>{const[t,n]=e.split(",");return Se(n,t)},o=e.querySelectorAll("Placemark");for(let e of o){if(e.querySelector("LineString")){const n=e.querySelector("LineString coordinates").innerHTML.trim().split(" ").map((e=>r(e)));t.push(n)}if(e.querySelector("Point")){const t=e.querySelector("name").innerHTML.trim(),o=r(e.querySelector("Point coordinates").innerHTML);n.push({name:t,point:o})}}return{lines:t,markers:n}}(t):e.name.endsWith(".gpx")?async function(e){const t=[],n=[],r=e=>Se(e.getAttribute("lat"),e.getAttribute("lon")),o=e.querySelectorAll("trkseg");for(let e of o){const n=Array.from(e.querySelectorAll("trkpt")).map((e=>r(e)));t.push(n)}const i=e.querySelectorAll("trkpt > name");for(let e of i){const t=e.innerHTML.trim(),o=r(e.parentElement);n.push({name:t,point:o})}if(0===n.length){const t=e.querySelectorAll("wpt");for(let e of t){const t=e.querySelector("name").innerHTML.trim(),o=r(e);n.push({name:t,point:o})}}return{lines:t,markers:n}}(t):void 0)).then((({lines:e,markers:t})=>async function(e,t){if(0===e.length)throw"Die Route enthält keine Linie.";if(0===t.length)throw"Die Route enthält keine Wegpunkte.";for(;e.length>1;){const t=Ce(e);if(null==t)throw"Die Route enthält Linien, die nicht miteinander verbunden sind.";t.reverseFirst&&e[t.i].reverse(),t.reverseSecond&&e[t.j].reverse(),e[t.i].push(...e[t.j]),e.splice(t.j,1)}const n=e[0];for(let e of t){let t=0,r=1/0;for(let o=0;o<n.length;o++){const i=se.distance(e.point,n[o]);i<r&&(t=o,r=i)}if(r>10)throw`Der Wegpunkt "${e.name}" ist nicht in der Nähe eines Eckpunkts der Linie.`;e.index=t,delete e.point}return t.sort(((e,t)=>e.index-t.index)),new ve(n,t)}(e,t))).then((e=>e.loadProfiles()))}function Se(e,t){const[n,r]=class{static WGStoCH(e,t){return[this.WGStoCHy(e,t),this.WGStoCHx(e,t)]}static WGStoCHx(e,t){const n=((e=this.DECtoSEX(e))-169028.66)/1e4,r=((t=this.DECtoSEX(t))-26782.5)/1e4;return 200147.07+308807.95*n+3745.25*Math.pow(r,2)+76.63*Math.pow(n,2)-194.56*Math.pow(r,2)*n+119.79*Math.pow(n,3)}static WGStoCHy(e,t){const n=((e=this.DECtoSEX(e))-169028.66)/1e4,r=((t=this.DECtoSEX(t))-26782.5)/1e4;return 600072.37+211455.93*r-10938.51*r*n-.36*r*Math.pow(n,2)-44.54*Math.pow(r,3)}static CHtoWGS(e,t){return[this.CHtoWGSlng(e,t),this.CHtoWGSlat(e,t)]}static CHtoWGSlat(e,t){const n=(e-6e5)/1e6,r=(t-2e5)/1e6;return 100*(16.9023892+3.238272*r-.270978*Math.pow(n,2)-.002528*Math.pow(r,2)-.0447*Math.pow(n,2)*r-.014*Math.pow(r,3))/36}static CHtoWGSlng(e,t){const n=(e-6e5)/1e6,r=(t-2e5)/1e6;return 100*(2.6779094+4.728982*n+.791484*n*r+.1306*n*Math.pow(r,2)-.0436*Math.pow(n,3))/36}static DECtoSEX(e){const t=parseInt(e),n=parseInt(60*(e-t));return 60*(60*(e-t)-n)+60*n+3600*t}}.WGStoCH(Number(e),Number(t));return{x:n,y:r}}function Ce(e){const t=(e,t)=>se.distance(e,t)<10;for(let n=0;n<e.length;n++)for(let r=n+1;r<e.length;r++){if(t(e[n][e[n].length-1],e[r][0]))return{i:n,j:r,reverseFirst:!1,reverseSecond:!1};if(t(e[n][0],e[r][e[r].length-1]))return{i:n,j:r,reverseFirst:!0,reverseSecond:!0};if(t(e[n][0],e[r][0]))return{i:n,j:r,reverseFirst:!0,reverseSecond:!1};if(t(e[n][e[n].length-1],e[r][e[r].length-1]))return{i:n,j:r,reverseFirst:!1,reverseSecond:!0}}return null}function Me(t){let n,r,o,i,s,l,m,$,b,x,v,k,w,y,S,C,M;return v=new V({props:{name:"upload_file"}}),{c(){n=h("h2"),n.textContent="Route hochladen",r=d(),o=h("p"),o.innerHTML='Unterstützt sind <b>KML-Dateien</b> von <a href="https://map.geo.admin.ch" target="_blank">map.geo.admin.ch</a> oder der <a href="https://www.swisstopo.admin.ch/en/maps-data-online/maps-geodata-online/swisstopo-app.html" target="_blank">swisstopo-App</a>, sowie <b>GPX-Dateien</b> von <a href="https://www.outdooractive.com/de/routeplanner" target="_blank">outdooractive.com</a>.',i=d(),s=h("p"),s.textContent="Datei hierher ziehen oder...",l=d(),m=h("input"),$=d(),b=h("button"),x=h("label"),N(v.$$.fragment),k=f(" Datei auswählen"),w=d(),y=h("br"),g(n,"class","svelte-1r58i7i"),g(m,"type","file"),g(m,"id","upload"),g(m,"accept",".kml, .gpx"),g(m,"class","svelte-1r58i7i"),g(x,"for","upload"),g(x,"class","svelte-1r58i7i")},m(e,u){c(e,n,u),c(e,r,u),c(e,o,u),c(e,i,u),c(e,s,u),c(e,l,u),c(e,m,u),c(e,$,u),c(e,b,u),a(b,x),q(v,x,null),a(x,k),c(e,w,u),c(e,y,u),S=!0,C||(M=p(m,"change",t[5]),C=!0)},p:e,i(e){S||(W(v.$$.fragment,e),S=!0)},o(e){G(v.$$.fragment,e),S=!1},d(e){e&&u(n),e&&u(r),e&&u(o),e&&u(i),e&&u(s),e&&u(l),e&&u(m),e&&u($),e&&u(b),O(v),e&&u(w),e&&u(y),C=!1,M()}}}function je(t){let n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:Le,then:De,catch:Pe,error:7};return R(r=t[1],o),{c(){n=f(""),o.block.c()},m(e,t){c(e,n,t),o.block.m(e,o.anchor=t),o.mount=()=>n.parentNode,o.anchor=n},p(e,n){t=e,o.ctx=t,2&n&&r!==(r=t[1])&&R(r,o)||function(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}(o,t,n)},i:e,o:e,d(e){e&&u(n),o.block.d(e),o.token=null,o=null}}}function Pe(e){let t,n,r,o,i,s,l,m,$,x,v=e[7]+"";return{c(){t=h("h3"),t.textContent="Hoppla!",n=d(),r=h("p"),o=f("Es gab einen Fehler beim Import:"),i=h("br"),s=f(v),l=d(),m=h("button"),m.textContent="Nochmal versuchen",g(m,"class","secondary")},m(u,h){c(u,t,h),c(u,n,h),c(u,r,h),a(r,o),a(r,i),a(r,s),c(u,l,h),c(u,m,h),$||(x=p(m,"click",e[4]),$=!0)},p(e,t){2&t&&v!==(v=e[7]+"")&&b(s,v)},d(e){e&&u(t),e&&u(n),e&&u(r),e&&u(l),e&&u(m),$=!1,x()}}}function De(t){return{c:e,m:e,p:e,d:e}}function Le(t){let n;return{c(){n=h("h3"),n.textContent="Route wird gewandert..."},m(e,t){c(e,n,t)},p:e,d(e){e&&u(n)}}}function Ee(e){let t,n,o,i,s,l;const a=[je,Me],f=[];function d(e,t){return e[0]&&e[0][0]?0:1}return n=d(e),o=f[n]=a[n](e),{c(){t=h("div"),o.c(),g(t,"class","svelte-1r58i7i")},m(r,o){c(r,t,o),f[n].m(t,null),i=!0,s||(l=[p(t,"drop",m(e[6])),p(t,"dragover",m(e[3]))],s=!0)},p(e,[r]){let i=n;n=d(e),n===i?f[n].p(e,r):(z(),G(f[i],1,1,(()=>{f[i]=null})),F(),o=f[n],o?o.p(e,r):(o=f[n]=a[n](e),o.c()),W(o,1),o.m(t,null))},i(e){i||(W(o),i=!0)},o(e){G(o),i=!1},d(e){e&&u(t),f[n].d(),s=!1,r(l)}}}function He(e,t,n){let r,o,{route:i=null}=t;return e.$$set=e=>{"route"in e&&n(2,i=e.route)},e.$$.update=()=>{1&e.$$.dirty&&r&&r[0]&&n(1,o=ye(r[0]).then((e=>n(2,i=e))))},[r,o,i,function(t){w.call(this,e,t)},()=>n(0,r=null),function(){r=this.files,n(0,r)},e=>n(0,r=e.dataTransfer.files)]}class Ae extends X{constructor(e){super(),B(this,e,He,Ee,i,{route:2})}}function _e(e){let t;return{c(){t=h("header"),t.innerHTML='<a href=".">❮ startseite</a>',g(t,"class","noprint")},m(e,n){c(e,t,n)},d(e){e&&u(t)}}}function Te(e){let t,n,o,i,s,l,m,b,v,k,w,y,S,C,M,j,P,D,L,E,H,A,_,T,z,F,R,U,B,X,I,J,K,Z,Q,Y,ee,te,ne,re;return l=new ie({props:{route:e[0],speed:e[1]}}),D=new V({props:{name:"swap_horiz"}}),F=new V({props:{name:"download"}}),J=new ge({props:{route:e[0],speed:e[1]}}),ee=new ue({props:{route:e[0]}}),{c(){t=h("div"),n=h("div"),o=h("div"),i=h("h2"),i.textContent="Route",s=d(),N(l.$$.fragment),m=d(),b=h("div"),v=h("h2"),v.textContent="Optionen",k=d(),w=h("label"),w.textContent="Geschwindigkeit in Lkm/h",y=d(),S=h("input"),C=d(),M=h("br"),j=d(),P=h("button"),N(D.$$.fragment),L=f(" Richtung wechseln"),E=d(),H=h("br"),A=d(),_=h("br"),T=d(),z=h("button"),N(F.$$.fragment),R=f(" Herunterladen"),U=d(),B=h("div"),X=h("h2"),X.textContent="Marschzeittabelle",I=d(),N(J.$$.fragment),K=d(),Z=h("div"),Q=h("h2"),Q.textContent="Höhenprofil",Y=d(),N(ee.$$.fragment),g(o,"class","info"),g(w,"for","speed"),g(w,"class","svelte-1icibwm"),g(S,"id","speed"),g(S,"type","number"),g(S,"min","0.5"),g(S,"step","0.5"),g(S,"class","svelte-1icibwm"),g(P,"class","secondary"),g(b,"class","options noprint svelte-1icibwm"),g(n,"class","general svelte-1icibwm"),g(B,"class","table svelte-1icibwm"),g(Z,"class","profile svelte-1icibwm"),g(t,"class","editor")},m(r,u){c(r,t,u),a(t,n),a(n,o),a(o,i),a(o,s),q(l,o,null),a(n,m),a(n,b),a(b,v),a(b,k),a(b,w),a(b,y),a(b,S),x(S,e[1]),a(b,C),a(b,M),a(b,j),a(b,P),q(D,P,null),a(P,L),a(b,E),a(b,H),a(b,A),a(b,_),a(b,T),a(b,z),q(F,z,null),a(z,R),a(t,U),a(t,B),a(B,X),a(B,I),q(J,B,null),a(t,K),a(t,Z),a(Z,Q),a(Z,Y),q(ee,Z,null),te=!0,ne||(re=[p(S,"input",e[4]),p(P,"click",e[2]),p(z,"click",We)],ne=!0)},p(e,t){const n={};1&t&&(n.route=e[0]),2&t&&(n.speed=e[1]),l.$set(n),2&t&&$(S.value)!==e[1]&&x(S,e[1]);const r={};1&t&&(r.route=e[0]),2&t&&(r.speed=e[1]),J.$set(r);const o={};1&t&&(o.route=e[0]),ee.$set(o)},i(e){te||(W(l.$$.fragment,e),W(D.$$.fragment,e),W(F.$$.fragment,e),W(J.$$.fragment,e),W(ee.$$.fragment,e),te=!0)},o(e){G(l.$$.fragment,e),G(D.$$.fragment,e),G(F.$$.fragment,e),G(J.$$.fragment,e),G(ee.$$.fragment,e),te=!1},d(e){e&&u(t),O(l),O(D),O(F),O(J),O(ee),ne=!1,r(re)}}}function ze(e){let t,n,r,o,i;function s(t){e[3](t)}t=new be({});let l={};return void 0!==e[0]&&(l.route=e[0]),r=new Ae({props:l}),S.push((()=>function(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}(r,"route",s))),{c(){N(t.$$.fragment),n=d(),N(r.$$.fragment)},m(e,o){q(t,e,o),c(e,n,o),q(r,e,o),i=!0},p(e,t){const n={};var i;!o&&1&t&&(o=!0,n.route=e[0],i=()=>o=!1,M.push(i)),r.$set(n)},i(e){i||(W(t.$$.fragment,e),W(r.$$.fragment,e),i=!0)},o(e){G(t.$$.fragment,e),G(r.$$.fragment,e),i=!1},d(e){O(t,e),e&&u(n),O(r,e)}}}function Fe(e){let t,n,r,o,i,s,l,a=null!=e[0]&&_e();const f=[ze,Te],p=[];function m(e,t){return null==e[0]?0:1}return r=m(e),o=p[r]=f[r](e),{c(){a&&a.c(),t=d(),n=h("main"),o.c(),i=d(),s=h("footer"),s.innerHTML='<span>marschzeittabelle.ch</span> \n    <span class="noprint">| <a href="help">hilfe</a>\n        | <a href="https://github.com/ckolin/marschzeittabelle">github</a></span>',g(s,"class","svelte-1icibwm")},m(e,o){a&&a.m(e,o),c(e,t,o),c(e,n,o),p[r].m(n,null),c(e,i,o),c(e,s,o),l=!0},p(e,[i]){null!=e[0]?a||(a=_e(),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null);let s=r;r=m(e),r===s?p[r].p(e,i):(z(),G(p[s],1,1,(()=>{p[s]=null})),F(),o=p[r],o?o.p(e,i):(o=p[r]=f[r](e),o.c()),W(o,1),o.m(n,null))},i(e){l||(W(o),l=!0)},o(e){G(o),l=!1},d(e){a&&a.d(e),e&&u(t),e&&u(n),p[r].d(),e&&u(i),e&&u(s)}}}function We(){window.print()}function Ge(e,t,n){let r,o=4;return[r,o,function(){r.reverse(),n(0,r)},function(e){r=e,n(0,r)},function(){o=$(this.value),n(1,o)}]}const Re=new class extends X{constructor(e){super(),B(this,e,Ge,Fe,i,{})}}({target:document.body});return function(){for(let e of Object.keys(le)){const t="--"+e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()));le[e]=window.getComputedStyle(document.body).getPropertyValue(t)}}(),Re}();
//# sourceMappingURL=bundle.js.map
