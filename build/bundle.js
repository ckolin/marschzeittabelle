var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let l,s;function a(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function f(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function d(){return h(" ")}function p(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function m(e){return function(t){return t.preventDefault(),e.call(this,t)}}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function $(e){return""===e?null:+e}function x(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function b(e,t){e.value=null==t?"":t}function v(e){s=e}function k(){if(!s)throw new Error("Function called outside component initialization");return s}function w(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const y=[],S=[],C=[],M=[],j=Promise.resolve();let L=!1;function P(e){C.push(e)}const E=new Set;let D=0;function H(){const e=s;do{for(;D<y.length;){const e=y[D];D++,v(e),A(e.$$)}for(v(null),y.length=0,D=0;S.length;)S.pop()();for(let e=0;e<C.length;e+=1){const t=C[e];E.has(t)||(E.add(t),t())}C.length=0}while(y.length);for(;M.length;)M.pop()();L=!1,E.clear(),v(e)}function A(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(P)}}const _=new Set;let T;function z(){T={r:0,c:[],p:T}}function F(){T.r||r(T.c),T=T.p}function W(e,t){e&&e.i&&(_.delete(e),e.i(t))}function G(e,t,n,r){if(e&&e.o){if(_.has(e))return;_.add(e),T.c.push((()=>{_.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}function R(e,t){const n=t.token={};function r(e,r,o,i){if(t.token!==n)return;t.resolved=i;let l=t.ctx;void 0!==o&&(l=l.slice(),l[o]=i);const s=e&&(t.current=e)(l);let a=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(z(),G(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),F())})):t.block.d(1),s.c(),W(s,1),s.m(t.mount(),t.anchor),a=!0),t.block=s,t.blocks&&(t.blocks[r]=s),a&&H()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const n=k();if(e.then((e=>{v(n),r(t.then,1,t.value,e),v(null)}),(e=>{if(v(n),r(t.catch,2,t.error,e),v(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}var o}function N(e){e&&e.c()}function q(e,n,i,l){const{fragment:s,on_mount:a,on_destroy:c,after_update:u}=e.$$;s&&s.m(n,i),l||P((()=>{const n=a.map(t).filter(o);c?c.push(...n):r(n),e.$$.on_mount=[]})),u.forEach(P)}function O(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function U(e,t){-1===e.$$.dirty[0]&&(y.push(e),L||(L=!0,j.then(H)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function B(t,o,i,l,a,c,f,h=[-1]){const d=s;v(t);const p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(d?d.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:o.target||d.$$.root};f&&f(p.root);let m=!1;if(p.ctx=i?i(t,o.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&a(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),m&&U(t,e)),n})):[],p.update(),m=!0,r(p.before_update),p.fragment=!!l&&l(p.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);p.fragment&&p.fragment.l(e),e.forEach(u)}else p.fragment&&p.fragment.c();o.intro&&W(t.$$.fragment),q(t,o.target,o.anchor,o.customElement),H()}v(d)}class X{$destroy(){O(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function I(t){let n,r;return{c(){n=f("span"),r=h(t[0]),g(n,"class","material-icons svelte-1ak8vae")},m(e,t){c(e,n,t),a(n,r)},p(e,[t]){1&t&&x(r,e[0])},i:e,o:e,d(e){e&&u(n)}}}function J(e,t,n){let{name:r}=t;return e.$$set=e=>{"name"in e&&n(0,r=e.name)},[r]}class V extends X{constructor(e){super(),B(this,e,J,I,i,{name:0})}}function K(t){let n,r,o;return{c(){n=f("a"),r=h(t[1]),g(n,"href",o=null==t[0]?"help":`help#${t[0]}`),g(n,"target","_blank"),g(n,"class","noprint svelte-o7pe1m")},m(e,t){c(e,n,t),a(n,r)},p(e,[t]){2&t&&x(r,e[1]),1&t&&o!==(o=null==e[0]?"help":`help#${e[0]}`)&&g(n,"href",o)},i:e,o:e,d(e){e&&u(n)}}}function Z(e,t,n){let{topic:r=null}=t,{label:o="?"}=t;return e.$$set=e=>{"topic"in e&&n(0,r=e.topic),"label"in e&&n(1,o=e.label)},[r,o]}class Q extends X{constructor(e){super(),B(this,e,Z,K,i,{topic:0,label:1})}}function Y(e){const{h:t,m:n}=te(e);return`${t}:${ne(n)}`}function ee(e){const{h:t,m:n}=te(e);return`${ne(t%24)}:${ne(n)}`}function te(e){const t=Math.floor(e);return{h:t,m:Math.round(60*(e-t))}}function ne(e){return e<10?`0${e}`:e.toString()}function re(e){let t,n,r,o,i,l,s,p,m,g,$,b,v,k,w,y,S,C,M,j,L,P,E,D,H,A,_,T,z,F,R,U,B,X,I,J,V,K,Z,ee,te=e[0].markers[0].name+"",ne=e[0].markers[e[0].markers.length-1].name+"",re=Math.round(e[3])+"",oe=Math.round(e[2])+"",ie=(e[0].distanceSum[e[0].line.length-1]/1e3).toFixed(1)+"",le=e[0].effortSum[e[0].markers.length-1].toFixed(1)+"",se=Y(e[0].effortSum[e[0].markers.length-1]/e[1])+"";return T=new Q({props:{topic:"calculation"}}),{c(){t=h("Start: "),n=f("b"),r=h(te),o=f("br"),i=h("\nEnde: "),l=f("b"),s=h(ne),p=f("br"),m=h("\nAuf-/Abstieg: ↑ "),g=f("b"),$=h(re),b=h(" m"),v=h(" ↓ "),k=f("b"),w=h(oe),y=h(" m"),S=f("br"),C=h("\nDistanz: "),M=f("b"),j=h(ie),L=h(" km"),P=f("br"),E=h("\nAufwand: "),D=f("b"),H=h(le),A=h(" Lkm"),_=d(),N(T.$$.fragment),z=f("br"),F=h("\nGeschwindigkeit: "),R=f("b"),U=h(e[1]),B=h(" Lkm/h"),X=f("br"),I=h("\nDauer: "),J=f("b"),V=h(se),K=h(" h"),Z=f("br")},m(e,u){c(e,t,u),c(e,n,u),a(n,r),c(e,o,u),c(e,i,u),c(e,l,u),a(l,s),c(e,p,u),c(e,m,u),c(e,g,u),a(g,$),a(g,b),c(e,v,u),c(e,k,u),a(k,w),a(k,y),c(e,S,u),c(e,C,u),c(e,M,u),a(M,j),a(M,L),c(e,P,u),c(e,E,u),c(e,D,u),a(D,H),a(D,A),c(e,_,u),q(T,e,u),c(e,z,u),c(e,F,u),c(e,R,u),a(R,U),a(R,B),c(e,X,u),c(e,I,u),c(e,J,u),a(J,V),a(J,K),c(e,Z,u),ee=!0},p(e,[t]){(!ee||1&t)&&te!==(te=e[0].markers[0].name+"")&&x(r,te),(!ee||1&t)&&ne!==(ne=e[0].markers[e[0].markers.length-1].name+"")&&x(s,ne),(!ee||8&t)&&re!==(re=Math.round(e[3])+"")&&x($,re),(!ee||4&t)&&oe!==(oe=Math.round(e[2])+"")&&x(w,oe),(!ee||1&t)&&ie!==(ie=(e[0].distanceSum[e[0].line.length-1]/1e3).toFixed(1)+"")&&x(j,ie),(!ee||1&t)&&le!==(le=e[0].effortSum[e[0].markers.length-1].toFixed(1)+"")&&x(H,le),(!ee||2&t)&&x(U,e[1]),(!ee||3&t)&&se!==(se=Y(e[0].effortSum[e[0].markers.length-1]/e[1])+"")&&x(V,se)},i(e){ee||(W(T.$$.fragment,e),ee=!0)},o(e){G(T.$$.fragment,e),ee=!1},d(e){e&&u(t),e&&u(n),e&&u(o),e&&u(i),e&&u(l),e&&u(p),e&&u(m),e&&u(g),e&&u(v),e&&u(k),e&&u(S),e&&u(C),e&&u(M),e&&u(P),e&&u(E),e&&u(D),e&&u(_),O(T,e),e&&u(z),e&&u(F),e&&u(R),e&&u(X),e&&u(I),e&&u(J),e&&u(Z)}}}function oe(e,t,n){let r,o,{route:i}=t,{speed:l}=t;return e.$$set=e=>{"route"in e&&n(0,i=e.route),"speed"in e&&n(1,l=e.speed)},e.$$.update=()=>{1&e.$$.dirty&&n(3,({ascent:r,descent:o}=function(e){let t=0,n=0;for(let r=1;r<e.markers.length;r++){const o=e.markerProfile[r].height-e.markerProfile[r-1].height;o>0?t+=o:n-=o}return{ascent:t,descent:n}}(i)),r,(n(2,o),n(0,i)))},[i,l,o,r]}class ie extends X{constructor(e){super(),B(this,e,oe,re,i,{route:0,speed:1})}}function le(t){let n,r,o,i,s,p,m,$,x,b,v,k,w,y,S,C,M,j,L,P,E;return w=new Q({props:{topic:"export",label:"Wie geht das?"}}),{c(){var e,t;n=f("div"),n.innerHTML='<h1 class="svelte-1578vb4">Marschzeit­tabelle<br/>leicht gemacht.</h1> \n<p class="subtitle svelte-1578vb4">Wir übertragen deine Route automatisch in eine Marschzeittabelle, damit du dich auf die Wanderplanung konzentrieren kannst.</p>',r=d(),o=f("div"),i=f("div"),s=f("h2"),s.textContent="1. Planen",p=d(),m=f("p"),m.textContent="Route einzeichnen und Wegpunkte benennen - das kennst du bereits.",$=d(),x=f("h2"),x.textContent="2. Exportieren",b=d(),v=f("p"),k=h("In wenigen Klicks erledigt. "),N(w.$$.fragment),y=d(),S=f("h2"),S.textContent="3. Hochladen",C=d(),M=f("p"),M.textContent="Jetzt noch Geschwindigkeit, Startzeit, Bemerkungen und Pausen hinzufügen.",j=d(),L=f("img"),g(n,"class","title svelte-1578vb4"),g(s,"class","svelte-1578vb4"),g(m,"class","svelte-1578vb4"),g(x,"class","svelte-1578vb4"),g(v,"class","svelte-1578vb4"),g(S,"class","svelte-1578vb4"),g(M,"class","svelte-1578vb4"),g(i,"class","svelte-1578vb4"),e=L.src,t=P="example.jpg",l||(l=document.createElement("a")),l.href=t,e!==l.href&&g(L,"src","example.jpg"),g(L,"alt","Beispiel"),g(L,"class","svelte-1578vb4"),g(o,"class","tutorial svelte-1578vb4")},m(e,t){c(e,n,t),c(e,r,t),c(e,o,t),a(o,i),a(i,s),a(i,p),a(i,m),a(i,$),a(i,x),a(i,b),a(i,v),a(v,k),q(w,v,null),a(i,y),a(i,S),a(i,C),a(i,M),a(o,j),a(o,L),E=!0},p:e,i(e){E||(W(w.$$.fragment,e),E=!0)},o(e){G(w.$$.fragment,e),E=!1},d(e){e&&u(n),e&&u(r),e&&u(o),O(w)}}}class se extends X{constructor(e){super(),B(this,e,null,le,i,{})}}function ae(e,t){return e.x===t.x&&e.y===t.y}function ce(e,t){return n=function(e,t){return{x:e.x-t.x,y:e.y-t.y}}(t,e),Math.hypot(n.x,n.y);var n}const ue={backgroundColor:null,textColor:null,darkerAccentColor:null,accentColor:null,lighterAccentColor:null};function fe(t){let n;return{c(){n=f("canvas"),g(n,"class","svelte-xd84ci")},m(e,r){c(e,n,r),t[2](n)},p:e,i:e,o:e,d(e){e&&u(n),t[2](null)}}}function he(e,t,n){let r,{route:o}=t;return e.$$set=e=>{"route"in e&&n(1,o=e.route)},e.$$.update=()=>{3&e.$$.dirty&&r&&(n(0,r.width=800,r),n(0,r.height=200,r),function(e,t){const n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);const r=12;let o=1/0,i=-1/0;for(let t of e.lineProfile)o=Math.min(o,t.height),i=Math.max(i,t.height);const l={x:e.distanceSum[e.distanceSum.length-1],y:i-o},s=Math.min((t.width-24)/l.x,(t.height-24-40)/l.y);t.width=Math.floor(l.x*s+24),t.height=Math.floor(l.y*s+24+40);const a=(e,n)=>{return i={x:(a={x:e,y:o-n}).x*(c=s),y:a.y*c},l={x:r,y:t.height-r-40},{x:i.x+l.x,y:i.y+l.y};var i,l,a,c},c=()=>{for(let t=0;t<e.lineProfile.length;t++){const r=a(e.lineProfileDistanceSum[t],e.lineProfile[t].height);0===t?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y)}};n.beginPath(),c();const u=a(0,i),f=a(0,o),h=a(l.x,o);n.lineTo(h.x,t.height),n.lineTo(f.x,t.height);const d=n.createLinearGradient(0,u.y,0,t.height);d.addColorStop(0,ue.lighterAccentColor),d.addColorStop(1,ue.backgroundColor),n.fillStyle=d,n.fill(),n.beginPath(),c(),n.lineWidth=4,n.lineCap=n.lineJoin="round",n.strokeStyle=ue.accentColor,n.stroke(),n.font="bold 14px sans-serif",n.textAlign="center",n.textBaseline="middle";for(let t=0;t<e.markerProfile.length;t++){const r=a(e.distanceSum[e.markers[t].index],e.markerProfile[t].height);n.beginPath(),n.arc(r.x,r.y,10,0,2*Math.PI),n.fillStyle=ue.darkerAccentColor,n.fill(),n.fillStyle=ue.backgroundColor,n.fillText(t+1,r.x,r.y+.5)}const p=125*2**Math.floor(Math.log2(120/(125*s))),m=p*s;n.fillStyle=ue.textColor,n.fillRect(t.width-r-m,t.height-4,m,2),n.fillRect(t.width-r-m,t.height-6,2,6),n.fillRect(t.width-r-2,t.height-6,2,6),n.textAlign="right",n.textBaseline="bottom",n.fillText(`${p} m`,t.width-r,t.height-6)}(o,r))},[r,o,function(e){S[e?"unshift":"push"]((()=>{r=e,n(0,r),n(1,o)}))}]}class de extends X{constructor(e){super(),B(this,e,he,fe,i,{route:1})}}function pe(e,t,n){const r=e.slice();return r[4]=t[n],r}function me(e){let t,n,r,o,i,l,s,p,m,$,b,v,k,w,y,S,C,M,j,L,P=Math.round(e[4].diff.height)+"",E=e[4].diff.distance.toFixed(1)+"",D=e[4].diff.effort.toFixed(1)+"",H=Y(e[4].diff.duration)+"";return{c(){t=f("tr"),n=f("td"),r=d(),o=f("td"),i=h(P),l=h(" m"),s=d(),p=f("td"),m=h(E),$=h(" km"),b=d(),v=f("td"),k=h(D),w=h(" Lkm"),y=d(),S=f("td"),C=h(H),M=h(" h"),j=d(),L=f("td"),g(n,"class","svelte-xjpfse"),g(o,"class","number svelte-xjpfse"),g(p,"class","number svelte-xjpfse"),g(v,"class","number svelte-xjpfse"),g(S,"class","number svelte-xjpfse"),g(L,"class","svelte-xjpfse"),g(t,"class","alt svelte-xjpfse")},m(e,u){c(e,t,u),a(t,n),a(t,r),a(t,o),a(o,i),a(o,l),a(t,s),a(t,p),a(p,m),a(p,$),a(t,b),a(t,v),a(v,k),a(v,w),a(t,y),a(t,S),a(S,C),a(S,M),a(t,j),a(t,L)},p(e,t){1&t&&P!==(P=Math.round(e[4].diff.height)+"")&&x(i,P),1&t&&E!==(E=e[4].diff.distance.toFixed(1)+"")&&x(m,E),1&t&&D!==(D=e[4].diff.effort.toFixed(1)+"")&&x(k,D),1&t&&H!==(H=Y(e[4].diff.duration)+"")&&x(C,H)},d(e){e&&u(t)}}}function ge(e){let t,n,r,o,i,l,s,p,m,$,b,v,k,w,y,S,C,M,j,L,P,E,D,H,A,_,T,z=e[4].index+"",F=e[4].name+"",W=Math.round(e[4].height)+"",G=e[4].distance.toFixed(1)+"",R=e[4].effort.toFixed(1)+"",N=Y(e[4].duration)+"",q=ee(e[4].duration)+"",O=e[4].diff&&me(e);return{c(){O&&O.c(),t=d(),n=f("tr"),r=f("td"),o=f("span"),i=h(z),l=d(),s=h(F),p=d(),m=f("td"),$=h(W),b=h(" m"),v=d(),k=f("td"),w=h(G),y=h(" km"),S=d(),C=f("td"),M=h(R),j=h(" Lkm"),L=d(),P=f("td"),E=h(N),D=h(" h"),H=d(),A=f("td"),_=h(q),T=d(),g(o,"class","svelte-xjpfse"),g(r,"class","name svelte-xjpfse"),g(m,"class","number svelte-xjpfse"),g(k,"class","number svelte-xjpfse"),g(C,"class","number svelte-xjpfse"),g(P,"class","number svelte-xjpfse"),g(A,"class","number svelte-xjpfse")},m(e,u){O&&O.m(e,u),c(e,t,u),c(e,n,u),a(n,r),a(r,o),a(o,i),a(r,l),a(r,s),a(n,p),a(n,m),a(m,$),a(m,b),a(n,v),a(n,k),a(k,w),a(k,y),a(n,S),a(n,C),a(C,M),a(C,j),a(n,L),a(n,P),a(P,E),a(P,D),a(n,H),a(n,A),a(A,_),a(n,T)},p(e,n){e[4].diff?O?O.p(e,n):(O=me(e),O.c(),O.m(t.parentNode,t)):O&&(O.d(1),O=null),1&n&&z!==(z=e[4].index+"")&&x(i,z),1&n&&F!==(F=e[4].name+"")&&x(s,F),1&n&&W!==(W=Math.round(e[4].height)+"")&&x($,W),1&n&&G!==(G=e[4].distance.toFixed(1)+"")&&x(w,G),1&n&&R!==(R=e[4].effort.toFixed(1)+"")&&x(M,R),1&n&&N!==(N=Y(e[4].duration)+"")&&x(E,N),1&n&&q!==(q=ee(e[4].duration)+"")&&x(_,q)},d(e){O&&O.d(e),e&&u(t),e&&u(n)}}}function $e(e){let t,n,r,o,i,l,s,m,$,x,b,v,k=e[0],w=[];for(let t=0;t<k.length;t+=1)w[t]=ge(pe(e,k,t));return m=new V({props:{name:"output"}}),{c(){t=f("table"),n=f("tr"),n.innerHTML='<th class="svelte-xjpfse">Wegpunkt</th> \n        <th class="svelte-xjpfse">Höhe</th> \n        <th class="svelte-xjpfse">Distanz</th> \n        <th class="svelte-xjpfse">Aufwand</th> \n        <th class="svelte-xjpfse">Dauer</th> \n        <th class="svelte-xjpfse">Uhrzeit</th>',r=d();for(let e=0;e<w.length;e+=1)w[e].c();o=d(),i=f("br"),l=d(),s=f("button"),N(m.$$.fragment),$=h(" CSV exportieren"),g(t,"class","svelte-xjpfse"),g(s,"class","noprint")},m(u,f){c(u,t,f),a(t,n),a(t,r);for(let e=0;e<w.length;e+=1)w[e].m(t,null);c(u,o,f),c(u,i,f),c(u,l,f),c(u,s,f),q(m,s,null),a(s,$),x=!0,b||(v=p(s,"click",e[1]),b=!0)},p(e,[n]){if(1&n){let r;for(k=e[0],r=0;r<k.length;r+=1){const o=pe(e,k,r);w[r]?w[r].p(o,n):(w[r]=ge(o),w[r].c(),w[r].m(t,null))}for(;r<w.length;r+=1)w[r].d(1);w.length=k.length}},i(e){x||(W(m.$$.fragment,e),x=!0)},o(e){G(m.$$.fragment,e),x=!1},d(e){e&&u(t),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(w,e),e&&u(o),e&&u(i),e&&u(l),e&&u(s),O(m),b=!1,v()}}}function xe(e,t,n){let{route:r}=t,{speed:o}=t,i=[];return e.$$set=e=>{"route"in e&&n(2,r=e.route),"speed"in e&&n(3,o=e.speed)},e.$$.update=()=>{12&e.$$.dirty&&!window.isNaN(o)&&o>0&&n(0,i=function(e,t){const n=[];for(let r=0;r<e.markers.length;r++)n[r]={index:r+1,name:e.markers[r].name,height:e.markerProfile[r].height,distance:e.distanceSum[e.markers[r].index]/1e3,effort:e.effortSum[r],duration:e.effortSum[r]/t},r>0&&(n[r].diff={height:n[r].height-n[r-1].height,distance:n[r].distance-n[r-1].distance,effort:e.effort[r],duration:n[r].duration-n[r-1].duration});return n}(r,o))},[i,function(){const e=[["Nr.","Name","Höhe / m","Unterschied Höhe / m","Total Distanz / km","Unterschied Distanz / km","Total Aufwand / Lkm","Unterschied Aufwand / Lkm","Total Dauer / h","Unterschied Dauer / h","Uhrzeit / h"],...i.map((e=>[e.index,e.name,e.height,e.diff?.height??0,e.distance,e.diff?.distance??0,e.effort,e.diff?.effort??0,e.duration,e.diff?.duration??0,e.duration]))].map((e=>e.map((e=>`"${e}"`)).join(","))).join("\n"),t=document.createElement("a");t.href=URL.createObjectURL(new Blob([e],{type:"text/csv"})),t.download="marschzeittabelle.csv",t.click()},r,o]}class be extends X{constructor(e){super(),B(this,e,xe,$e,i,{route:2,speed:3})}}function ve(e,t,n){const r={type:"LineString",coordinates:e.map((e=>[Math.round(e.x),Math.round(e.y)]))};return fetch("https://api3.geo.admin.ch/rest/services/profile.json",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`sr=21781&distinct_points=${t}&nb_points=${n}&geom=${JSON.stringify(r)}`}).then((e=>{if(e.ok)return e.json();throw"Das Höhenprofil konnte nicht geladen werden."})).then((n=>new Promise((r=>{let o=n.map((e=>({point:{x:e.easting,y:e.northing},height:e.alts.COMB})));t&&(o=o.filter((t=>e.some((e=>ce(t.point,e)<2))))),r(o)})))).catch((()=>{throw"Die Verbindung zu den swisstopo-Servern ist fehlgeschlagen."}))}function ke(e){e.distanceSum=we(e.line),e.lineProfileDistanceSum=we(e.lineProfile.map((e=>e.point))),e.effort=function(e){const t=[];t[0]=0;for(let n=1;n<e.markers.length;n++){const r=e.distanceSum[e.markers[n].index]-e.distanceSum[e.markers[n-1].index],o=e.markerProfile[n].height-e.markerProfile[n-1].height,i=o/r;t[n]=r/1e3,i>0?t[n]+=o/100:i<-.2&&(t[n]+=Math.abs(o)/150)}return t}(e),e.effortSum=ye(e.effort)}function we(e){return ye(e.map(((t,n)=>ce(e[Math.max(0,n-1)],e[n]))))}function ye(e){const t=[];let n=0;for(let r=0;r<e.length;r++)n+=e[r],t[r]=n;return t}function Se(e){return function(e){return new Promise(((t,n)=>{const r=new FileReader;r.addEventListener("load",(()=>t(r.result))),r.addEventListener("error",(()=>n("Die Datei konnte nicht gelesen werden."))),r.readAsText(e)}))}(e).then((e=>async function(e){const t=(new DOMParser).parseFromString(e,"application/xml");if(t.querySelector("parsererror"))throw"Die Datei ist nicht in gültigem XML-Format.";return t}(e))).then((t=>e.name.endsWith(".kml")?async function(e){const t=[],n=[],r=e=>{const[t,n]=e.split(",");return Ce(n,t)},o=e.querySelectorAll("Placemark");for(let e of o){if(e.querySelector("LineString")){const n=e.querySelector("LineString coordinates").innerHTML.trim().split(" ").map((e=>r(e)));t.push(n)}if(e.querySelector("Point")){const t=e.querySelector("name").innerHTML.trim(),o=r(e.querySelector("Point coordinates").innerHTML);n.push({name:t,point:o})}}return{lines:t,markers:n}}(t):e.name.endsWith(".gpx")?async function(e){const t=[],n=[],r=e=>Ce(e.getAttribute("lat"),e.getAttribute("lon")),o=e.querySelectorAll("trkseg");for(let e of o){const n=Array.from(e.querySelectorAll("trkpt")).map((e=>r(e)));t.push(n)}const i=e.querySelectorAll("trkpt > name");for(let e of i){const t=e.innerHTML.trim(),o=r(e.parentElement);n.push({name:t,point:o})}if(0===n.length){const t=e.querySelectorAll("wpt");for(let e of t){const t=e.querySelector("name").innerHTML.trim(),o=r(e);n.push({name:t,point:o})}}return{lines:t,markers:n}}(t):void 0)).then((({lines:e,markers:t})=>async function(e,t){if(0===e.length)throw"Die Route enthält keine Linie.";if(0===t.length)throw"Die Route enthält keine Wegpunkte.";for(;e.length>1;){const t=Me(e);if(null==t)throw"Die Route enthält Linien, die nicht miteinander verbunden sind.";t.reverseFirst&&e[t.i].reverse(),t.reverseSecond&&e[t.j].reverse(),e[t.i].push(...e[t.j]),e.splice(t.j,1)}const n=e[0];let r=null;for(let e=0;e<n.length;e++){const o=t.filter((e=>null==r||!ae(e.point,r))).filter((t=>ce(t.point,n[e])<10));if(0===o.length)continue;const i=o.filter((e=>null==e.index));if(o.length>1){throw`Mehrere Wegpunkte am selben Ort: ${i.map((e=>`"${e.name}"`)).join(", ")}.`}const l=o[0];null==l.index?l.index=e:t.push({name:l.name,point:l.point,index:e}),r=l.point}const o=t.filter((e=>null==e.index));if(o.length>0){throw`Wegpunkte nicht in der Nähe von Eckpunkten der Linie: ${o.map((e=>`"${e.name}"`)).join(", ")}.`}return t.sort(((e,t)=>e.index-t.index)),{line:n,markers:t}}(e,t))).then((e=>async function(e){return e.lineProfile=await ve(e.line,!1,100),e.markerProfile=await ve(e.markers.map((t=>e.line[t.index])),!0,e.markers.length),ke(e),e}(e)))}function Ce(e,t){const[n,r]=class{static WGStoCH(e,t){return[this.WGStoCHy(e,t),this.WGStoCHx(e,t)]}static WGStoCHx(e,t){const n=((e=this.DECtoSEX(e))-169028.66)/1e4,r=((t=this.DECtoSEX(t))-26782.5)/1e4;return 200147.07+308807.95*n+3745.25*Math.pow(r,2)+76.63*Math.pow(n,2)-194.56*Math.pow(r,2)*n+119.79*Math.pow(n,3)}static WGStoCHy(e,t){const n=((e=this.DECtoSEX(e))-169028.66)/1e4,r=((t=this.DECtoSEX(t))-26782.5)/1e4;return 600072.37+211455.93*r-10938.51*r*n-.36*r*Math.pow(n,2)-44.54*Math.pow(r,3)}static CHtoWGS(e,t){return[this.CHtoWGSlng(e,t),this.CHtoWGSlat(e,t)]}static CHtoWGSlat(e,t){const n=(e-6e5)/1e6,r=(t-2e5)/1e6;return 100*(16.9023892+3.238272*r-.270978*Math.pow(n,2)-.002528*Math.pow(r,2)-.0447*Math.pow(n,2)*r-.014*Math.pow(r,3))/36}static CHtoWGSlng(e,t){const n=(e-6e5)/1e6,r=(t-2e5)/1e6;return 100*(2.6779094+4.728982*n+.791484*n*r+.1306*n*Math.pow(r,2)-.0436*Math.pow(n,3))/36}static DECtoSEX(e){const t=parseInt(e),n=parseInt(60*(e-t));return 60*(60*(e-t)-n)+60*n+3600*t}}.WGStoCH(Number(e),Number(t));return{x:n,y:r}}function Me(e){const t=(e,t)=>ce(e,t)<10;for(let n=0;n<e.length;n++)for(let r=n+1;r<e.length;r++){if(t(e[n][e[n].length-1],e[r][0]))return{i:n,j:r,reverseFirst:!1,reverseSecond:!1};if(t(e[n][0],e[r][e[r].length-1]))return{i:n,j:r,reverseFirst:!0,reverseSecond:!0};if(t(e[n][0],e[r][0]))return{i:n,j:r,reverseFirst:!0,reverseSecond:!1};if(t(e[n][e[n].length-1],e[r][e[r].length-1]))return{i:n,j:r,reverseFirst:!1,reverseSecond:!0}}return null}function je(t){let n,r,o,i,l,s,m,$,x,b,v,k,w,y,S,C,M;return v=new V({props:{name:"upload_file"}}),{c(){n=f("h2"),n.textContent="Route hochladen",r=d(),o=f("p"),o.innerHTML='Unterstützt sind <b>KML-Dateien</b> von <a href="https://map.geo.admin.ch" target="_blank">map.geo.admin.ch</a> oder der <a href="https://www.swisstopo.admin.ch/en/maps-data-online/maps-geodata-online/swisstopo-app.html" target="_blank">swisstopo-App</a>, sowie <b>GPX-Dateien</b> von <a href="https://www.outdooractive.com/de/routeplanner" target="_blank">outdooractive.com</a>.',i=d(),l=f("p"),l.textContent="Datei hierher ziehen oder...",s=d(),m=f("input"),$=d(),x=f("button"),b=f("label"),N(v.$$.fragment),k=h(" Datei auswählen"),w=d(),y=f("br"),g(n,"class","svelte-1r58i7i"),g(m,"type","file"),g(m,"id","upload"),g(m,"accept",".kml, .gpx"),g(m,"class","svelte-1r58i7i"),g(b,"for","upload"),g(b,"class","svelte-1r58i7i")},m(e,u){c(e,n,u),c(e,r,u),c(e,o,u),c(e,i,u),c(e,l,u),c(e,s,u),c(e,m,u),c(e,$,u),c(e,x,u),a(x,b),q(v,b,null),a(b,k),c(e,w,u),c(e,y,u),S=!0,C||(M=p(m,"change",t[5]),C=!0)},p:e,i(e){S||(W(v.$$.fragment,e),S=!0)},o(e){G(v.$$.fragment,e),S=!1},d(e){e&&u(n),e&&u(r),e&&u(o),e&&u(i),e&&u(l),e&&u(s),e&&u(m),e&&u($),e&&u(x),O(v),e&&u(w),e&&u(y),C=!1,M()}}}function Le(t){let n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:De,then:Ee,catch:Pe,error:7};return R(r=t[1],o),{c(){n=h(""),o.block.c()},m(e,t){c(e,n,t),o.block.m(e,o.anchor=t),o.mount=()=>n.parentNode,o.anchor=n},p(e,n){t=e,o.ctx=t,2&n&&r!==(r=t[1])&&R(r,o)||function(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}(o,t,n)},i:e,o:e,d(e){e&&u(n),o.block.d(e),o.token=null,o=null}}}function Pe(e){let t,n,r,o,i,l,s,m,$,b,v=e[7]+"";return{c(){t=f("h3"),t.textContent="Hoppla!",n=d(),r=f("p"),o=h("Es gab einen Fehler beim Import:"),i=f("br"),l=h(v),s=d(),m=f("button"),m.textContent="Nochmal versuchen",g(m,"class","secondary")},m(u,f){c(u,t,f),c(u,n,f),c(u,r,f),a(r,o),a(r,i),a(r,l),c(u,s,f),c(u,m,f),$||(b=p(m,"click",e[4]),$=!0)},p(e,t){2&t&&v!==(v=e[7]+"")&&x(l,v)},d(e){e&&u(t),e&&u(n),e&&u(r),e&&u(s),e&&u(m),$=!1,b()}}}function Ee(t){return{c:e,m:e,p:e,d:e}}function De(t){let n;return{c(){n=f("h3"),n.textContent="Route wird gewandert..."},m(e,t){c(e,n,t)},p:e,d(e){e&&u(n)}}}function He(e){let t,n,o,i,l,s;const a=[Le,je],h=[];function d(e,t){return e[0]&&e[0][0]?0:1}return n=d(e),o=h[n]=a[n](e),{c(){t=f("div"),o.c(),g(t,"class","svelte-1r58i7i")},m(r,o){c(r,t,o),h[n].m(t,null),i=!0,l||(s=[p(t,"drop",m(e[6])),p(t,"dragover",m(e[3]))],l=!0)},p(e,[r]){let i=n;n=d(e),n===i?h[n].p(e,r):(z(),G(h[i],1,1,(()=>{h[i]=null})),F(),o=h[n],o?o.p(e,r):(o=h[n]=a[n](e),o.c()),W(o,1),o.m(t,null))},i(e){i||(W(o),i=!0)},o(e){G(o),i=!1},d(e){e&&u(t),h[n].d(),l=!1,r(s)}}}function Ae(e,t,n){let r,o,{route:i=null}=t;return e.$$set=e=>{"route"in e&&n(2,i=e.route)},e.$$.update=()=>{1&e.$$.dirty&&r&&r[0]&&n(1,o=Se(r[0]).then((e=>n(2,i=e))))},[r,o,i,function(t){w.call(this,e,t)},()=>n(0,r=null),function(){r=this.files,n(0,r)},e=>n(0,r=e.dataTransfer.files)]}class _e extends X{constructor(e){super(),B(this,e,Ae,He,i,{route:2})}}function Te(e){let t;return{c(){t=f("header"),t.innerHTML='<a href=".">❮ startseite</a>',g(t,"class","noprint")},m(e,n){c(e,t,n)},d(e){e&&u(t)}}}function ze(e){let t,n,o,i,l,s,m,x,v,k,w,y,S,C,M,j,L,P,E,D,H,A,_,T,z,F,R,U,B,X,I,J,K,Z,Q,Y,ee,te,ne,re;return s=new ie({props:{route:e[0],speed:e[1]}}),P=new V({props:{name:"swap_horiz"}}),F=new V({props:{name:"download"}}),J=new be({props:{route:e[0],speed:e[1]}}),ee=new de({props:{route:e[0]}}),{c(){t=f("div"),n=f("div"),o=f("div"),i=f("h2"),i.textContent="Route",l=d(),N(s.$$.fragment),m=d(),x=f("div"),v=f("h2"),v.textContent="Optionen",k=d(),w=f("label"),w.textContent="Geschwindigkeit in Lkm/h",y=d(),S=f("input"),C=d(),M=f("br"),j=d(),L=f("button"),N(P.$$.fragment),E=h(" Richtung wechseln"),D=d(),H=f("br"),A=d(),_=f("br"),T=d(),z=f("button"),N(F.$$.fragment),R=h(" Herunterladen"),U=d(),B=f("div"),X=f("h2"),X.textContent="Marschzeittabelle",I=d(),N(J.$$.fragment),K=d(),Z=f("div"),Q=f("h2"),Q.textContent="Höhenprofil",Y=d(),N(ee.$$.fragment),g(o,"class","info"),g(w,"for","speed"),g(w,"class","svelte-1dl81do"),g(S,"id","speed"),g(S,"type","number"),g(S,"min","0.5"),g(S,"step","0.5"),g(S,"class","svelte-1dl81do"),g(L,"class","secondary"),g(x,"class","options noprint svelte-1dl81do"),g(n,"class","general svelte-1dl81do"),g(B,"class","table svelte-1dl81do"),g(Z,"class","profile svelte-1dl81do"),g(t,"class","editor")},m(r,u){c(r,t,u),a(t,n),a(n,o),a(o,i),a(o,l),q(s,o,null),a(n,m),a(n,x),a(x,v),a(x,k),a(x,w),a(x,y),a(x,S),b(S,e[1]),a(x,C),a(x,M),a(x,j),a(x,L),q(P,L,null),a(L,E),a(x,D),a(x,H),a(x,A),a(x,_),a(x,T),a(x,z),q(F,z,null),a(z,R),a(t,U),a(t,B),a(B,X),a(B,I),q(J,B,null),a(t,K),a(t,Z),a(Z,Q),a(Z,Y),q(ee,Z,null),te=!0,ne||(re=[p(S,"input",e[4]),p(L,"click",e[2]),p(z,"click",Ge)],ne=!0)},p(e,t){const n={};1&t&&(n.route=e[0]),2&t&&(n.speed=e[1]),s.$set(n),2&t&&$(S.value)!==e[1]&&b(S,e[1]);const r={};1&t&&(r.route=e[0]),2&t&&(r.speed=e[1]),J.$set(r);const o={};1&t&&(o.route=e[0]),ee.$set(o)},i(e){te||(W(s.$$.fragment,e),W(P.$$.fragment,e),W(F.$$.fragment,e),W(J.$$.fragment,e),W(ee.$$.fragment,e),te=!0)},o(e){G(s.$$.fragment,e),G(P.$$.fragment,e),G(F.$$.fragment,e),G(J.$$.fragment,e),G(ee.$$.fragment,e),te=!1},d(e){e&&u(t),O(s),O(P),O(F),O(J),O(ee),ne=!1,r(re)}}}function Fe(e){let t,n,r,o,i;function l(t){e[3](t)}t=new se({});let s={};return void 0!==e[0]&&(s.route=e[0]),r=new _e({props:s}),S.push((()=>function(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}(r,"route",l))),{c(){N(t.$$.fragment),n=d(),N(r.$$.fragment)},m(e,o){q(t,e,o),c(e,n,o),q(r,e,o),i=!0},p(e,t){const n={};var i;!o&&1&t&&(o=!0,n.route=e[0],i=()=>o=!1,M.push(i)),r.$set(n)},i(e){i||(W(t.$$.fragment,e),W(r.$$.fragment,e),i=!0)},o(e){G(t.$$.fragment,e),G(r.$$.fragment,e),i=!1},d(e){O(t,e),e&&u(n),O(r,e)}}}function We(e){let t,n,r,o,i,l,s,a=null!=e[0]&&Te();const h=[Fe,ze],p=[];function m(e,t){return null==e[0]?0:1}return r=m(e),o=p[r]=h[r](e),{c(){a&&a.c(),t=d(),n=f("main"),o.c(),i=d(),l=f("footer"),l.innerHTML='<span>marschzeittabelle.ch</span> \n    <span class="noprint">| <a href="help">hilfe</a>\n        | <a href="https://github.com/ckolin/marschzeittabelle">github</a></span>',g(l,"class","svelte-1dl81do")},m(e,o){a&&a.m(e,o),c(e,t,o),c(e,n,o),p[r].m(n,null),c(e,i,o),c(e,l,o),s=!0},p(e,[i]){null!=e[0]?a||(a=Te(),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null);let l=r;r=m(e),r===l?p[r].p(e,i):(z(),G(p[l],1,1,(()=>{p[l]=null})),F(),o=p[r],o?o.p(e,i):(o=p[r]=h[r](e),o.c()),W(o,1),o.m(n,null))},i(e){s||(W(o),s=!0)},o(e){G(o),s=!1},d(e){a&&a.d(e),e&&u(t),e&&u(n),p[r].d(),e&&u(i),e&&u(l)}}}function Ge(){window.print()}function Re(e,t,n){let r,o=4;return[r,o,function(){!function(e){e.line.reverse(),e.markers.reverse(),e.lineProfile?.reverse(),e.markerProfile?.reverse(),e.markers.forEach((t=>t.index=e.line.length-t.index-1)),ke(e)}(r),n(0,r)},function(e){r=e,n(0,r)},function(){o=$(this.value),n(1,o)}]}const Ne=new class extends X{constructor(e){super(),B(this,e,Re,We,i,{})}}({target:document.body});return function(){for(let e of Object.keys(ue)){const t="--"+e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()));ue[e]=window.getComputedStyle(document.body).getPropertyValue(t)}}(),Ne}();
//# sourceMappingURL=bundle.js.map
