var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let s,l;function c(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode.removeChild(t)}function h(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function f(){return d(" ")}function p(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function m(t){return function(e){return e.preventDefault(),t.call(this,e)}}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t){return""===t?null:+t}function $(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function v(t,e){t.value=null==e?"":e}function x(t){l=t}function k(){if(!l)throw new Error("Function called outside component initialization");return l}function w(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const y=[],S=[],C=[],M=[],P=Promise.resolve();let D=!1;function E(t){C.push(t)}const L=new Set;let H=0;function A(){const t=l;do{for(;H<y.length;){const t=y[H];H++,x(t),_(t.$$)}for(x(null),y.length=0,H=0;S.length;)S.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];L.has(e)||(L.add(e),e())}C.length=0}while(y.length);for(;M.length;)M.pop()();D=!1,L.clear(),x(t)}function _(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const F=new Set;let W;function T(){W={r:0,c:[],p:W}}function z(){W.r||r(W.c),W=W.p}function G(t,e){t&&t.i&&(F.delete(t),t.i(e))}function j(t,e,n,r){if(t&&t.o){if(F.has(t))return;F.add(t),W.c.push((()=>{F.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function N(t,e){const n=e.token={};function r(t,r,o,i){if(e.token!==n)return;e.resolved=i;let s=e.ctx;void 0!==o&&(s=s.slice(),s[o]=i);const l=t&&(e.current=t)(s);let c=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==r&&t&&(T(),j(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),z())})):e.block.d(1),l.c(),G(l,1),l.m(e.mount(),e.anchor),c=!0),e.block=l,e.blocks&&(e.blocks[r]=l),c&&A()}if((o=t)&&"object"==typeof o&&"function"==typeof o.then){const n=k();if(t.then((t=>{x(n),r(e.then,1,e.value,t),x(null)}),(t=>{if(x(n),r(e.catch,2,e.error,t),x(null),!e.hasCatch)throw t})),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}var o}function R(t){t&&t.c()}function q(t,n,i,s){const{fragment:l,on_mount:c,on_destroy:a,after_update:u}=t.$$;l&&l.m(n,i),s||E((()=>{const n=c.map(e).filter(o);a?a.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(E)}function O(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function X(t,e){-1===t.$$.dirty[0]&&(y.push(t),D||(D=!0,P.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function I(e,o,i,s,c,a,h,d=[-1]){const f=l;x(e);const p=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(f?f.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:o.target||f.$$.root};h&&h(p.root);let m=!1;if(p.ctx=i?i(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&c(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),m&&X(e,t)),n})):[],p.update(),m=!0,r(p.before_update),p.fragment=!!s&&s(p.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);p.fragment&&p.fragment.l(t),t.forEach(u)}else p.fragment&&p.fragment.c();o.intro&&G(e.$$.fragment),q(e,o.target,o.anchor,o.customElement),A()}x(f)}class B{$destroy(){O(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function J(e){let n,r,o;return{c(){n=h("a"),r=d("?"),g(n,"href",o=null==e[0]?"help":`help#${e[0]}`),g(n,"target","_blank"),g(n,"class","noprint svelte-ypmtrw")},m(t,e){a(t,n,e),c(n,r)},p(t,[e]){1&e&&o!==(o=null==t[0]?"help":`help#${t[0]}`)&&g(n,"href",o)},i:t,o:t,d(t){t&&u(n)}}}function V(t,e,n){let{topic:r=null}=e;return t.$$set=t=>{"topic"in t&&n(0,r=t.topic)},[r]}class K extends B{constructor(t){super(),I(this,t,V,J,i,{topic:0})}}function U(t){const{h:e,m:n}=Q(t);return`${e}:${Y(n)}`}function Z(t){const{h:e,m:n}=Q(t);return`${Y(e%24)}:${Y(n)}`}function Q(t){const e=Math.floor(t);return{h:e,m:Math.round(60*(t-e))}}function Y(t){return t<10?`0${t}`:t.toString()}function tt(t){let e,n,r,o,i,s,l,p,m,g,b,v,x,k,w,y,S,C,M,P,D,E,L,H,A,_,F,W,T,z,N,X,I,B,J,V,Z,Q,Y,tt,et=t[0].markers[0].name+"",nt=t[0].markers[t[0].markers.length-1].name+"",rt=Math.round(t[3])+"",ot=Math.round(t[2])+"",it=(t[0].distanceSum[t[0].line.length-1]/1e3).toFixed(1)+"",st=t[0].effortSum[t[0].markers.length-1].toFixed(1)+"",lt=U(t[0].effortSum[t[0].markers.length-1]/t[1])+"";return W=new K({props:{topic:"calculation"}}),{c(){e=d("Start: "),n=h("b"),r=d(et),o=h("br"),i=d("\r\nEnde: "),s=h("b"),l=d(nt),p=h("br"),m=d("\r\nAuf-/Abstieg: ↑ "),g=h("b"),b=d(rt),v=d(" m"),x=d(" ↓ "),k=h("b"),w=d(ot),y=d(" m"),S=h("br"),C=d("\r\nDistanz: "),M=h("b"),P=d(it),D=d(" km"),E=h("br"),L=d("\r\nAufwand: "),H=h("b"),A=d(st),_=d(" Lkm"),F=f(),R(W.$$.fragment),T=h("br"),z=d("\r\nGeschwindigkeit: "),N=h("b"),X=d(t[1]),I=d(" Lkm/h"),B=h("br"),J=d("\r\nDauer: "),V=h("b"),Z=d(lt),Q=d(" h"),Y=h("br")},m(t,u){a(t,e,u),a(t,n,u),c(n,r),a(t,o,u),a(t,i,u),a(t,s,u),c(s,l),a(t,p,u),a(t,m,u),a(t,g,u),c(g,b),c(g,v),a(t,x,u),a(t,k,u),c(k,w),c(k,y),a(t,S,u),a(t,C,u),a(t,M,u),c(M,P),c(M,D),a(t,E,u),a(t,L,u),a(t,H,u),c(H,A),c(H,_),a(t,F,u),q(W,t,u),a(t,T,u),a(t,z,u),a(t,N,u),c(N,X),c(N,I),a(t,B,u),a(t,J,u),a(t,V,u),c(V,Z),c(V,Q),a(t,Y,u),tt=!0},p(t,[e]){(!tt||1&e)&&et!==(et=t[0].markers[0].name+"")&&$(r,et),(!tt||1&e)&&nt!==(nt=t[0].markers[t[0].markers.length-1].name+"")&&$(l,nt),(!tt||8&e)&&rt!==(rt=Math.round(t[3])+"")&&$(b,rt),(!tt||4&e)&&ot!==(ot=Math.round(t[2])+"")&&$(w,ot),(!tt||1&e)&&it!==(it=(t[0].distanceSum[t[0].line.length-1]/1e3).toFixed(1)+"")&&$(P,it),(!tt||1&e)&&st!==(st=t[0].effortSum[t[0].markers.length-1].toFixed(1)+"")&&$(A,st),(!tt||2&e)&&$(X,t[1]),(!tt||3&e)&&lt!==(lt=U(t[0].effortSum[t[0].markers.length-1]/t[1])+"")&&$(Z,lt)},i(t){tt||(G(W.$$.fragment,t),tt=!0)},o(t){j(W.$$.fragment,t),tt=!1},d(t){t&&u(e),t&&u(n),t&&u(o),t&&u(i),t&&u(s),t&&u(p),t&&u(m),t&&u(g),t&&u(x),t&&u(k),t&&u(S),t&&u(C),t&&u(M),t&&u(E),t&&u(L),t&&u(H),t&&u(F),O(W,t),t&&u(T),t&&u(z),t&&u(N),t&&u(B),t&&u(J),t&&u(V),t&&u(Y)}}}function et(t,e,n){let r,o,{route:i}=e,{speed:s}=e;return t.$$set=t=>{"route"in t&&n(0,i=t.route),"speed"in t&&n(1,s=t.speed)},t.$$.update=()=>{1&t.$$.dirty&&n(3,({ascent:r,descent:o}=function(t){let e=0,n=0;for(let r=1;r<t.markers.length;r++){const o=t.markerProfile[r].height-t.markerProfile[r-1].height;o>0?e+=o:n-=o}return{ascent:e,descent:n}}(i)),r,(n(2,o),n(0,i)))},[i,s,o,r]}class nt extends B{constructor(t){super(),I(this,t,et,tt,i,{route:0,speed:1})}}class rt{static add(t,e){return{x:t.x+e.x,y:t.y+e.y}}static subtract(t,e){return{x:t.x-e.x,y:t.y-e.y}}static scale(t,e){return{x:t.x*e,y:t.y*e}}static length(t){return Math.hypot(t.x,t.y)}static distance(t,e){return rt.length(rt.subtract(e,t))}}const ot={backgroundColor:null,textColor:null,darkerAccentColor:null,accentColor:null,lighterAccentColor:null};function it(e){let n;return{c(){n=h("canvas"),g(n,"class","svelte-xd84ci")},m(t,r){a(t,n,r),e[2](n)},p:t,i:t,o:t,d(t){t&&u(n),e[2](null)}}}function st(t,e,n){let r,{route:o}=e;return t.$$set=t=>{"route"in t&&n(1,o=t.route)},t.$$.update=()=>{3&t.$$.dirty&&r&&(n(0,r.width=800,r),n(0,r.height=150,r),function(t,e){const n=e.getContext("2d");n.clearRect(0,0,e.width,e.height);const r=12;let o=1/0,i=-1/0;for(let e of t.lineProfile)o=Math.min(o,e.height),i=Math.max(i,e.height);const s={x:t.distanceSum[t.distanceSum.length-1],y:i-o},l=Math.min((e.width-24)/s.x,(e.height-24-40)/s.y);e.width=Math.floor(s.x*l+24),e.height=Math.floor(s.y*l+24+40);const c=(t,n)=>rt.add(rt.scale({x:t,y:o-n},l),{x:r,y:e.height-r-40}),a=()=>{for(let e=0;e<t.lineProfile.length;e++){const r=c(t.lineProfileDistanceSum[e],t.lineProfile[e].height);0===e?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y)}};n.beginPath(),a();const u=c(0,i),h=c(0,o),d=c(s.x,o);n.lineTo(d.x,e.height),n.lineTo(h.x,e.height);const f=n.createLinearGradient(0,u.y,0,e.height);f.addColorStop(0,ot.lighterAccentColor),f.addColorStop(1,ot.backgroundColor),n.fillStyle=f,n.globalAlpha=.5,n.fill(),n.globalAlpha=1,n.beginPath(),a(),n.lineWidth=4,n.lineCap=n.lineJoin="round",n.strokeStyle=ot.accentColor,n.stroke(),n.font="bold 14px sans-serif",n.textAlign="center",n.textBaseline="middle";for(let e=0;e<t.markerProfile.length;e++){const r=c(t.distanceSum[t.markers[e].index],t.markerProfile[e].height);n.beginPath(),n.arc(r.x,r.y,10,0,2*Math.PI),n.fillStyle=ot.darkerAccentColor,n.fill(),n.fillStyle=ot.backgroundColor,n.fillText(e+1,r.x,r.y+.5)}}(o,r))},[r,o,function(t){S[t?"unshift":"push"]((()=>{r=t,n(0,r),n(1,o)}))}]}class lt extends B{constructor(t){super(),I(this,t,st,it,i,{route:1})}}function ct(t,e,n){const r=t.slice();return r[3]=e[n],r}function at(t){let e,n,r,o,i,s,l,p,m,b,v,x,k,w,y,S,C,M,P,D,E=Math.round(t[3].diff.height)+"",L=t[3].diff.distance.toFixed(1)+"",H=t[3].diff.effort.toFixed(1)+"",A=U(t[3].diff.duration)+"";return{c(){e=h("tr"),n=h("td"),r=f(),o=h("td"),i=d(E),s=d(" m"),l=f(),p=h("td"),m=d(L),b=d(" km"),v=f(),x=h("td"),k=d(H),w=d(" Lkm"),y=f(),S=h("td"),C=d(A),M=d(" h"),P=f(),D=h("td"),g(n,"class","svelte-16h3hgu"),g(o,"class","number svelte-16h3hgu"),g(p,"class","number svelte-16h3hgu"),g(x,"class","number svelte-16h3hgu"),g(S,"class","number svelte-16h3hgu"),g(D,"class","svelte-16h3hgu"),g(e,"class","alt svelte-16h3hgu")},m(t,u){a(t,e,u),c(e,n),c(e,r),c(e,o),c(o,i),c(o,s),c(e,l),c(e,p),c(p,m),c(p,b),c(e,v),c(e,x),c(x,k),c(x,w),c(e,y),c(e,S),c(S,C),c(S,M),c(e,P),c(e,D)},p(t,e){1&e&&E!==(E=Math.round(t[3].diff.height)+"")&&$(i,E),1&e&&L!==(L=t[3].diff.distance.toFixed(1)+"")&&$(m,L),1&e&&H!==(H=t[3].diff.effort.toFixed(1)+"")&&$(k,H),1&e&&A!==(A=U(t[3].diff.duration)+"")&&$(C,A)},d(t){t&&u(e)}}}function ut(t){let e,n,r,o,i,s,l,p,m,b,v,x,k,w,y,S,C,M,P,D,E,L,H,A,_,F,W,T=t[3].index+"",z=t[3].name+"",G=Math.round(t[3].height)+"",j=t[3].distance.toFixed(1)+"",N=t[3].effort.toFixed(1)+"",R=U(t[3].duration)+"",q=Z(t[3].duration)+"",O=t[3].diff&&at(t);return{c(){O&&O.c(),e=f(),n=h("tr"),r=h("td"),o=h("span"),i=d(T),s=f(),l=d(z),p=f(),m=h("td"),b=d(G),v=d(" m"),x=f(),k=h("td"),w=d(j),y=d(" km"),S=f(),C=h("td"),M=d(N),P=d(" Lkm"),D=f(),E=h("td"),L=d(R),H=d(" h"),A=f(),_=h("td"),F=d(q),W=f(),g(o,"class","svelte-16h3hgu"),g(r,"class","name svelte-16h3hgu"),g(m,"class","number svelte-16h3hgu"),g(k,"class","number svelte-16h3hgu"),g(C,"class","number svelte-16h3hgu"),g(E,"class","number svelte-16h3hgu"),g(_,"class","number svelte-16h3hgu")},m(t,u){O&&O.m(t,u),a(t,e,u),a(t,n,u),c(n,r),c(r,o),c(o,i),c(r,s),c(r,l),c(n,p),c(n,m),c(m,b),c(m,v),c(n,x),c(n,k),c(k,w),c(k,y),c(n,S),c(n,C),c(C,M),c(C,P),c(n,D),c(n,E),c(E,L),c(E,H),c(n,A),c(n,_),c(_,F),c(n,W)},p(t,n){t[3].diff?O?O.p(t,n):(O=at(t),O.c(),O.m(e.parentNode,e)):O&&(O.d(1),O=null),1&n&&T!==(T=t[3].index+"")&&$(i,T),1&n&&z!==(z=t[3].name+"")&&$(l,z),1&n&&G!==(G=Math.round(t[3].height)+"")&&$(b,G),1&n&&j!==(j=t[3].distance.toFixed(1)+"")&&$(w,j),1&n&&N!==(N=t[3].effort.toFixed(1)+"")&&$(M,N),1&n&&R!==(R=U(t[3].duration)+"")&&$(L,R),1&n&&q!==(q=Z(t[3].duration)+"")&&$(F,q)},d(t){O&&O.d(t),t&&u(e),t&&u(n)}}}function ht(e){let n,r,o,i=e[0],s=[];for(let t=0;t<i.length;t+=1)s[t]=ut(ct(e,i,t));return{c(){n=h("table"),r=h("tr"),r.innerHTML='<th class="svelte-16h3hgu">Wegpunkt</th> \n        <th class="svelte-16h3hgu">Höhe</th> \n        <th class="svelte-16h3hgu">Distanz</th> \n        <th class="svelte-16h3hgu">Aufwand</th> \n        <th class="svelte-16h3hgu">Dauer</th> \n        <th class="svelte-16h3hgu">Uhrzeit</th>',o=f();for(let t=0;t<s.length;t+=1)s[t].c();g(n,"class","svelte-16h3hgu")},m(t,e){a(t,n,e),c(n,r),c(n,o);for(let t=0;t<s.length;t+=1)s[t].m(n,null)},p(t,[e]){if(1&e){let r;for(i=t[0],r=0;r<i.length;r+=1){const o=ct(t,i,r);s[r]?s[r].p(o,e):(s[r]=ut(o),s[r].c(),s[r].m(n,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=i.length}},i:t,o:t,d(t){t&&u(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(s,t)}}}function dt(t,e,n){let{route:r}=e,{speed:o}=e,i=[];return t.$$set=t=>{"route"in t&&n(1,r=t.route),"speed"in t&&n(2,o=t.speed)},t.$$.update=()=>{6&t.$$.dirty&&!window.isNaN(o)&&o>0&&n(0,i=function(t,e){const n=[];for(let r=0;r<t.markers.length;r++)n[r]={index:r+1,name:t.markers[r].name,height:t.markerProfile[r].height,distance:t.distanceSum[t.markers[r].index]/1e3,effort:t.effortSum[r],duration:t.effortSum[r]/e},r>0&&(n[r].diff={height:n[r].height-n[r-1].height,distance:n[r].distance-n[r-1].distance,effort:t.effort[r],duration:n[r].duration-n[r-1].duration});return n}(r,o))},[i,r,o]}class ft extends B{constructor(t){super(),I(this,t,dt,ht,i,{route:1,speed:2})}}function pt(e){let n,r,o,i,l,p,m,b,$,v,x,k,w,y,S,C,M,P,D,E,L;return w=new K({props:{topic:"export"}}),{c(){var t,e;n=h("div"),n.innerHTML='<h1 class="svelte-1578vb4">Marschzeit­tabelle<br/>leicht gemacht.</h1> \n<p class="subtitle svelte-1578vb4">Wir übertragen deine Route automatisch in eine Marschzeittabelle, damit du dich auf die Wanderplanung konzentrieren kannst.</p>',r=f(),o=h("div"),i=h("div"),l=h("h2"),l.textContent="1. Route planen",p=f(),m=h("p"),m.textContent="Route einzeichnen, Wegpunkte benennen - das kennst du bereits.",b=f(),$=h("h2"),$.textContent="2. Exportieren und hochladen",v=f(),x=h("p"),k=d("In wenigen Klicks erledigt. "),R(w.$$.fragment),y=f(),S=h("h2"),S.textContent="3. Voilà!",C=f(),M=h("p"),M.textContent="Schon hast du deine Marschzeittabelle. Jetzt noch Geschwindigkeit, Startzeit und Pausen anpassen.",P=f(),D=h("img"),g(n,"class","title svelte-1578vb4"),g(l,"class","svelte-1578vb4"),g(m,"class","svelte-1578vb4"),g($,"class","svelte-1578vb4"),g(x,"class","svelte-1578vb4"),g(S,"class","svelte-1578vb4"),g(M,"class","svelte-1578vb4"),g(i,"class","svelte-1578vb4"),t=D.src,e=E="example.png",s||(s=document.createElement("a")),s.href=e,t!==s.href&&g(D,"src","example.png"),g(D,"alt","Beispiel"),g(D,"class","svelte-1578vb4"),g(o,"class","tutorial svelte-1578vb4")},m(t,e){a(t,n,e),a(t,r,e),a(t,o,e),c(o,i),c(i,l),c(i,p),c(i,m),c(i,b),c(i,$),c(i,v),c(i,x),c(x,k),q(w,x,null),c(i,y),c(i,S),c(i,C),c(i,M),c(o,P),c(o,D),L=!0},p:t,i(t){L||(G(w.$$.fragment,t),L=!0)},o(t){j(w.$$.fragment,t),L=!1},d(t){t&&u(n),t&&u(r),t&&u(o),O(w)}}}class mt extends B{constructor(t){super(),I(this,t,null,pt,i,{})}}function gt(t,e,n){const r={type:"LineString",coordinates:t.map((t=>[Math.round(t.x),Math.round(t.y)]))};return fetch(`https://api3.geo.admin.ch/rest/services/profile.json?sr=21781&distinct_points=${e}&nb_points=${n}&geom=${JSON.stringify(r)}`).then((t=>{if(t.ok)return t.json();throw"Das Höhenprofil konnte nicht geladen werden."})).then((n=>new Promise((r=>{let o=n.map((t=>({point:{x:t.easting,y:t.northing},height:t.alts.COMB})));e&&(o=o.filter((e=>t.some((t=>rt.distance(e.point,t)<2))))),r(o)})))).catch((()=>{throw"Die Verbindung zu den swisstopo-Servern ist fehlgeschlagen."}))}class bt{constructor(t,e){this.line=t,this.markers=e}async loadProfiles(){return this.lineProfile=await gt(this.line,!1,100),this.markerProfile=await gt(this.markers.map((t=>this.line[t.index])),!0,this.markers.length),this.calculateDistances(),this}reverse(){this.line.reverse(),this.markers.reverse(),this.markers.forEach((t=>t.index=this.line.length-t.index-1)),this.lineProfile?.reverse(),this.markerProfile?.reverse(),this.calculateDistances()}calculateDistances(){this.distanceSum=$t(this.line),this.lineProfileDistanceSum=$t(this.lineProfile.map((t=>t.point))),this.effort=[],this.effort[0]=0;for(let t=1;t<this.markers.length;t++){const e=this.distanceSum[this.markers[t].index]-this.distanceSum[this.markers[t-1].index],n=this.markerProfile[t].height-this.markerProfile[t-1].height,r=n/e;this.effort[t]=e/1e3,r>0?this.effort[t]+=n/100:r<-.2&&(this.effort[t]+=Math.abs(r)/150)}this.effortSum=vt(this.effort)}}function $t(t){return vt(t.map(((e,n)=>rt.distance(t[Math.max(0,n-1)],t[n]))))}function vt(t){const e=[];let n=0;for(let r=0;r<t.length;r++)n+=t[r],e[r]=n;return e}function xt(t){return function(t){return new Promise(((e,n)=>{const r=new FileReader;r.addEventListener("load",(()=>e(r.result))),r.addEventListener("error",(()=>n("Die Datei konnte nicht gelesen werden."))),r.readAsText(t)}))}(t).then((t=>async function(t){const e=(new DOMParser).parseFromString(t,"application/xml");if(e.querySelector("parsererror"))throw"Die Datei ist nicht in gültigem XML-Format.";return e}(t))).then((e=>t.name.endsWith(".kml")?async function(t){const e=[],n=[],r=t=>{const[e,n]=t.split(",");return kt(n,e)},o=t.querySelectorAll("Placemark");for(let t of o){if(t.querySelector("LineString")){const n=t.querySelector("LineString coordinates").innerHTML.trim().split(" ").map((t=>r(t)));e.push(n)}if(t.querySelector("Point")){const e=t.querySelector("name").innerHTML.trim(),o=r(t.querySelector("Point coordinates").innerHTML);n.push({name:e,point:o})}}return{lines:e,markers:n}}(e):t.name.endsWith(".gpx")?async function(t){const e=[],n=[],r=t=>kt(t.getAttribute("lat"),t.getAttribute("lon")),o=t.querySelectorAll("trkseg");for(let t of o){const n=Array.from(t.querySelectorAll("trkpt")).map((t=>r(t)));e.push(n)}const i=t.querySelectorAll("trkpt > name");for(let t of i){const e=t.innerHTML,o=r(t.parentElement);n.push({name:e,point:o})}return{lines:e,markers:n}}(e):void 0)).then((({lines:t,markers:e})=>async function(t,e){if(0===t.length)throw"Die Route enthält keine Linie.";if(0===e.length)throw"Die Route enthält keine Wegpunkte.";for(;t.length>1;){const e=wt(t);if(null==e)throw"Die Route enthält Linien, die nicht miteinander verbunden sind.";e.reverseFirst&&t[e.i].reverse(),e.reverseSecond&&t[e.j].reverse(),t[e.i].push(...t[e.j]),t.splice(e.j,1)}const n=t[0];for(let t of e){let e=0,r=1/0;for(let o=0;o<n.length;o++){const i=rt.distance(t.point,n[o]);i<r&&(e=o,r=i)}if(r>10)throw`Der Wegpunkt "${t.name}" ist nicht in der Nähe eines Eckpunkts der Linie.`;t.index=e,delete t.point}return e.sort(((t,e)=>t.index-e.index)),new bt(n,e)}(t,e))).then((t=>t.loadProfiles()))}function kt(t,e){const[n,r]=class{static WGStoCH(t,e){return[this.WGStoCHy(t,e),this.WGStoCHx(t,e)]}static WGStoCHx(t,e){const n=((t=this.DECtoSEX(t))-169028.66)/1e4,r=((e=this.DECtoSEX(e))-26782.5)/1e4;return 200147.07+308807.95*n+3745.25*Math.pow(r,2)+76.63*Math.pow(n,2)-194.56*Math.pow(r,2)*n+119.79*Math.pow(n,3)}static WGStoCHy(t,e){const n=((t=this.DECtoSEX(t))-169028.66)/1e4,r=((e=this.DECtoSEX(e))-26782.5)/1e4;return 600072.37+211455.93*r-10938.51*r*n-.36*r*Math.pow(n,2)-44.54*Math.pow(r,3)}static CHtoWGS(t,e){return[this.CHtoWGSlng(t,e),this.CHtoWGSlat(t,e)]}static CHtoWGSlat(t,e){const n=(t-6e5)/1e6,r=(e-2e5)/1e6;return 100*(16.9023892+3.238272*r-.270978*Math.pow(n,2)-.002528*Math.pow(r,2)-.0447*Math.pow(n,2)*r-.014*Math.pow(r,3))/36}static CHtoWGSlng(t,e){const n=(t-6e5)/1e6,r=(e-2e5)/1e6;return 100*(2.6779094+4.728982*n+.791484*n*r+.1306*n*Math.pow(r,2)-.0436*Math.pow(n,3))/36}static DECtoSEX(t){const e=parseInt(t),n=parseInt(60*(t-e));return 60*(60*(t-e)-n)+60*n+3600*e}}.WGStoCH(Number(t),Number(e));return{x:n,y:r}}function wt(t){const e=(t,e)=>rt.distance(t,e)<10;for(let n=0;n<t.length;n++)for(let r=n+1;r<t.length;r++){if(e(t[n][t[n].length-1],t[r][0]))return{i:n,j:r,reverseFirst:!1,reverseSecond:!1};if(e(t[n][0],t[r][t[r].length-1]))return{i:n,j:r,reverseFirst:!0,reverseSecond:!0};if(e(t[n][0],t[r][0]))return{i:n,j:r,reverseFirst:!0,reverseSecond:!1};if(e(t[n][t[n].length-1],t[r][t[r].length-1]))return{i:n,j:r,reverseFirst:!1,reverseSecond:!0}}return null}function yt(e){let n,r,o,i,s,l,c,d,m,b,$,v,x;return{c(){n=h("h2"),n.textContent="Route hochladen",r=f(),o=h("p"),o.innerHTML='Unterstützt sind <b>KML-Dateien</b> von <a href="https://map.geo.admin.ch" target="_blank">map.geo.admin.ch</a> oder der <a href="https://www.swisstopo.admin.ch/en/maps-data-online/maps-geodata-online/swisstopo-app.html" target="_blank">swisstopo-App</a>, sowie <b>GPX-Dateien</b> von <a href="https://www.outdooractive.com/de/routeplanner" target="_blank">outdooractive.com</a>.',i=f(),s=h("p"),s.textContent="Datei hierher ziehen oder...",l=f(),c=h("input"),d=f(),m=h("button"),m.innerHTML='<label for="upload" class="svelte-1r58i7i">Datei auswählen</label>',b=f(),$=h("br"),g(n,"class","svelte-1r58i7i"),g(c,"type","file"),g(c,"id","upload"),g(c,"accept",".kml, .gpx"),g(c,"class","svelte-1r58i7i")},m(t,u){a(t,n,u),a(t,r,u),a(t,o,u),a(t,i,u),a(t,s,u),a(t,l,u),a(t,c,u),a(t,d,u),a(t,m,u),a(t,b,u),a(t,$,u),v||(x=p(c,"change",e[5]),v=!0)},p:t,d(t){t&&u(n),t&&u(r),t&&u(o),t&&u(i),t&&u(s),t&&u(l),t&&u(c),t&&u(d),t&&u(m),t&&u(b),t&&u($),v=!1,x()}}}function St(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:Pt,then:Mt,catch:Ct,error:7};return N(n=t[1],r),{c(){e=d(""),r.block.c()},m(t,n){a(t,e,n),r.block.m(t,r.anchor=n),r.mount=()=>e.parentNode,r.anchor=e},p(e,o){t=e,r.ctx=t,2&o&&n!==(n=t[1])&&N(n,r)||function(t,e,n){const r=e.slice(),{resolved:o}=t;t.current===t.then&&(r[t.value]=o),t.current===t.catch&&(r[t.error]=o),t.block.p(r,n)}(r,t,o)},d(t){t&&u(e),r.block.d(t),r.token=null,r=null}}}function Ct(t){let e,n,r,o,i,s,l,m,b,v,x=t[7]+"";return{c(){e=h("h3"),e.textContent="Hoppla!",n=f(),r=h("p"),o=d("Es gab einen Fehler beim Import:"),i=h("br"),s=d(x),l=f(),m=h("button"),m.textContent="Nochmal versuchen",g(m,"class","secondary")},m(u,h){a(u,e,h),a(u,n,h),a(u,r,h),c(r,o),c(r,i),c(r,s),a(u,l,h),a(u,m,h),b||(v=p(m,"click",t[4]),b=!0)},p(t,e){2&e&&x!==(x=t[7]+"")&&$(s,x)},d(t){t&&u(e),t&&u(n),t&&u(r),t&&u(l),t&&u(m),b=!1,v()}}}function Mt(e){return{c:t,m:t,p:t,d:t}}function Pt(e){let n;return{c(){n=h("h3"),n.textContent="Route wird gewandert..."},m(t,e){a(t,n,e)},p:t,d(t){t&&u(n)}}}function Dt(e){let n,o,i;function s(t,e){return t[0]&&t[0][0]?St:yt}let l=s(e),c=l(e);return{c(){n=h("div"),c.c(),g(n,"class","svelte-1r58i7i")},m(t,r){a(t,n,r),c.m(n,null),o||(i=[p(n,"drop",m(e[6])),p(n,"dragover",m(e[3]))],o=!0)},p(t,[e]){l===(l=s(t))&&c?c.p(t,e):(c.d(1),c=l(t),c&&(c.c(),c.m(n,null)))},i:t,o:t,d(t){t&&u(n),c.d(),o=!1,r(i)}}}function Et(t,e,n){let r,o,{route:i=null}=e;return t.$$set=t=>{"route"in t&&n(2,i=t.route)},t.$$.update=()=>{1&t.$$.dirty&&r&&r[0]&&n(1,o=xt(r[0]).then((t=>n(2,i=t))))},[r,o,i,function(e){w.call(this,t,e)},()=>n(0,r=null),function(){r=this.files,n(0,r)},t=>n(0,r=t.dataTransfer.files)]}class Lt extends B{constructor(t){super(),I(this,t,Et,Dt,i,{route:2})}}function Ht(t){let e;return{c(){e=h("header"),e.innerHTML='<a href=".">❮ startseite</a>',g(e,"class","noprint")},m(t,n){a(t,e,n)},d(t){t&&u(e)}}}function At(t){let e,n,o,i,s,l,d,m,$,x,k,w,y,S,C,M,P,D,E,L,H,A,_,F,W,T,z,N,X,I,B,J,V,K,U,Z;return l=new nt({props:{route:t[0],speed:t[1]}}),N=new ft({props:{route:t[0],speed:t[1]}}),V=new lt({props:{route:t[0]}}),{c(){e=h("div"),n=h("div"),o=h("div"),i=h("h2"),i.textContent="Route",s=f(),R(l.$$.fragment),d=f(),m=h("div"),$=h("h2"),$.textContent="Optionen",x=f(),k=h("label"),k.textContent="Geschwindigkeit in Lkm/h",w=f(),y=h("input"),S=f(),C=h("br"),M=f(),P=h("button"),P.textContent="Richtung wechseln",D=f(),E=h("br"),L=f(),H=h("br"),A=f(),_=h("button"),_.textContent="Herunterladen",F=f(),W=h("div"),T=h("h2"),T.textContent="Marschzeittabelle",z=f(),R(N.$$.fragment),X=f(),I=h("div"),B=h("h2"),B.textContent="Höhenprofil",J=f(),R(V.$$.fragment),g(o,"class","info"),g(k,"for","speed"),g(k,"class","svelte-1icibwm"),g(y,"id","speed"),g(y,"type","number"),g(y,"min","0.5"),g(y,"step","0.5"),g(y,"class","svelte-1icibwm"),g(P,"class","secondary"),g(m,"class","options noprint svelte-1icibwm"),g(n,"class","general svelte-1icibwm"),g(W,"class","table svelte-1icibwm"),g(I,"class","profile svelte-1icibwm"),g(e,"class","editor")},m(r,u){a(r,e,u),c(e,n),c(n,o),c(o,i),c(o,s),q(l,o,null),c(n,d),c(n,m),c(m,$),c(m,x),c(m,k),c(m,w),c(m,y),v(y,t[1]),c(m,S),c(m,C),c(m,M),c(m,P),c(m,D),c(m,E),c(m,L),c(m,H),c(m,A),c(m,_),c(e,F),c(e,W),c(W,T),c(W,z),q(N,W,null),c(e,X),c(e,I),c(I,B),c(I,J),q(V,I,null),K=!0,U||(Z=[p(y,"input",t[4]),p(P,"click",t[2]),p(_,"click",Wt)],U=!0)},p(t,e){const n={};1&e&&(n.route=t[0]),2&e&&(n.speed=t[1]),l.$set(n),2&e&&b(y.value)!==t[1]&&v(y,t[1]);const r={};1&e&&(r.route=t[0]),2&e&&(r.speed=t[1]),N.$set(r);const o={};1&e&&(o.route=t[0]),V.$set(o)},i(t){K||(G(l.$$.fragment,t),G(N.$$.fragment,t),G(V.$$.fragment,t),K=!0)},o(t){j(l.$$.fragment,t),j(N.$$.fragment,t),j(V.$$.fragment,t),K=!1},d(t){t&&u(e),O(l),O(N),O(V),U=!1,r(Z)}}}function _t(t){let e,n,r,o,i;function s(e){t[3](e)}e=new mt({});let l={};return void 0!==t[0]&&(l.route=t[0]),r=new Lt({props:l}),S.push((()=>function(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}(r,"route",s))),{c(){R(e.$$.fragment),n=f(),R(r.$$.fragment)},m(t,o){q(e,t,o),a(t,n,o),q(r,t,o),i=!0},p(t,e){const n={};var i;!o&&1&e&&(o=!0,n.route=t[0],i=()=>o=!1,M.push(i)),r.$set(n)},i(t){i||(G(e.$$.fragment,t),G(r.$$.fragment,t),i=!0)},o(t){j(e.$$.fragment,t),j(r.$$.fragment,t),i=!1},d(t){O(e,t),t&&u(n),O(r,t)}}}function Ft(t){let e,n,r,o,i,s,l,c=null!=t[0]&&Ht();const d=[_t,At],p=[];function m(t,e){return null==t[0]?0:1}return r=m(t),o=p[r]=d[r](t),{c(){c&&c.c(),e=f(),n=h("main"),o.c(),i=f(),s=h("footer"),s.innerHTML='<span>marschzeittabelle.ch</span> \n    <span class="noprint">| <a href="help">hilfe</a>\n        | <a href="https://github.com/ckolin/marschzeittabelle">github</a></span>',g(s,"class","svelte-1icibwm")},m(t,o){c&&c.m(t,o),a(t,e,o),a(t,n,o),p[r].m(n,null),a(t,i,o),a(t,s,o),l=!0},p(t,[i]){null!=t[0]?c||(c=Ht(),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let s=r;r=m(t),r===s?p[r].p(t,i):(T(),j(p[s],1,1,(()=>{p[s]=null})),z(),o=p[r],o?o.p(t,i):(o=p[r]=d[r](t),o.c()),G(o,1),o.m(n,null))},i(t){l||(G(o),l=!0)},o(t){j(o),l=!1},d(t){c&&c.d(t),t&&u(e),t&&u(n),p[r].d(),t&&u(i),t&&u(s)}}}function Wt(){window.print()}function Tt(t,e,n){let r,o=4;return[r,o,function(){r.reverse(),n(0,r)},function(t){r=t,n(0,r)},function(){o=b(this.value),n(1,o)}]}const zt=new class extends B{constructor(t){super(),I(this,t,Tt,Ft,i,{})}}({target:document.body});return function(){for(let t of Object.keys(ot)){const e="--"+t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));ot[t]=window.getComputedStyle(document.body).getPropertyValue(e)}}(),zt}();
//# sourceMappingURL=bundle.js.map
